/*! janeswalk 2014-11-17 */
function MVCArrayBinder(a){this.array_=a}function MapEditor(a){var b=this,c=[{featureType:"poi.business",stylers:[{visibility:"off"}]}],d={zoom:15,scrollwheel:!1,rotateControl:!0,center:new google.maps.LatLng(a.city.lat,a.city.lng),mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE]}};this.map={},this.markers=[],this.poly={},this.point=[],this.userLocation=!1,window.freeGeoIpCallback=function(a){b.userLocation=new google.maps.LatLng(a.latitude,a.longitude)},$.getScript("http://freegeoip.net/json/?callback=freeGeoIpCallback"),this.infowindow=new google.maps.InfoWindow,this.pathMarker=new google.maps.MarkerImage("/img/path.marker.png",null,new google.maps.Point(0,0),new google.maps.Point(8,10)),this.stopMarker={url:"../../../img/marker.png",size:new google.maps.Size(30,46),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(11,44)},this.map=new google.maps.Map(document.querySelector("#map-canvas"),d),this.map.setOptions({styles:c}),this.initPoly()}if(Function.prototype.bind||(Function.prototype.bind=function(a){"use strict";if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),function(){"use strict";var a=Object.prototype,b=a.__defineGetter__,c=a.__defineSetter__,d=a.__lookupGetter__,e=a.__lookupSetter__,f=a.hasOwnProperty;b&&c&&d&&e&&(Object.defineProperty||(Object.defineProperty=function(a,g,h){if(arguments.length<3)throw new TypeError("Arguments not optional");if(g+="",f.call(h,"value")&&(!d.call(a,g)&&!e.call(a,g)&&(a[g]=h.value),f.call(h,"get")||f.call(h,"set")))throw new TypeError("Cannot specify an accessor and a value");if(!(h.writable&&h.enumerable&&h.configurable))throw new TypeError("This implementation of Object.defineProperty does not support false for configurable, enumerable, or writable.");return h.get&&b.call(a,g,h.get),h.set&&c.call(a,g,h.set),a}),Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(a,b){if(arguments.length<2)throw new TypeError("Arguments not optional.");b+="";var c={configurable:!0,enumerable:!0,writable:!0},g=d.call(a,b),h=e.call(a,b);return f.call(a,b)?g||h?(delete c.writable,c.get=c.set=void 0,g&&(c.get=g),h&&(c.set=h),c):(c.value=a[b],c):c}),Object.defineProperties||(Object.defineProperties=function(a,b){var c;for(c in b)f.call(b,c)&&Object.defineProperty(a,c,b[c])}))}(),!(document.documentElement.dataset||Object.getOwnPropertyDescriptor(Element.prototype,"dataset")&&Object.getOwnPropertyDescriptor(Element.prototype,"dataset").get)){var propDescriptor={enumerable:!0,get:function(){"use strict";var a,b,c,d,e,f,g=this,h=this.attributes,i=h.length,j=function(a){return a.charAt(1).toUpperCase()},k=function(){return this},l=function(a,b){return"undefined"!=typeof b?this.setAttribute(a,b):this.removeAttribute(a)};try{({}).__defineGetter__("test",function(){}),b={}}catch(m){b=document.createElement("div")}for(a=0;i>a;a++)if(f=h[a],f&&f.name&&/^data-\w[\w\-]*$/.test(f.name)){c=f.value,d=f.name,e=d.substr(5).replace(/-./g,j);try{Object.defineProperty(b,e,{enumerable:this.enumerable,get:k.bind(c||""),set:l.bind(g,d)})}catch(n){b[e]=c}}return b}};try{Object.defineProperty(Element.prototype,"dataset",propDescriptor)}catch(e){propDescriptor.enumerable=!1,Object.defineProperty(Element.prototype,"dataset",propDescriptor)}}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(a){"use strict";if(void 0===a||null===a)throw new TypeError("Cannot convert first argument to object");for(var b,c=Object(a),d=!1,e=1;e<arguments.length;e++){var f=arguments[e];if(void 0!==f&&null!==f){for(var g=Object.keys(Object(f)),h=0,i=g.length;i>h;h++){var j=g[h];try{var k=Object.getOwnPropertyDescriptor(f,j);void 0!==k&&k.enumerable&&(c[j]=f[j])}catch(l){d||(d=!0,b=l)}}if(d)throw b}}return c}}),function(a){function b(){var a=arguments[0],c=b.cache;return c[a]&&c.hasOwnProperty(a)||(c[a]=b.parse(a)),b.format.call(null,c[a],arguments)}function c(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function d(a,b){return Array(b+1).join(a)}var e={not_string:/[^s]/,number:/[dief]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fiosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};b.format=function(a,f){var g,h,i,j,k,l,m,n=1,o=a.length,p="",q=[],r=!0,s="";for(h=0;o>h;h++)if(p=c(a[h]),"string"===p)q[q.length]=a[h];else if("array"===p){if(j=a[h],j[2])for(g=f[n],i=0;i<j[2].length;i++){if(!g.hasOwnProperty(j[2][i]))throw new Error(b("[sprintf] property '%s' does not exist",j[2][i]));g=g[j[2][i]]}else g=j[1]?f[j[1]]:f[n++];if("function"==c(g)&&(g=g()),e.not_string.test(j[8])&&"number"!=c(g)&&isNaN(g))throw new TypeError(b("[sprintf] expecting number but found %s",c(g)));switch(e.number.test(j[8])&&(r=g>=0),j[8]){case"b":g=g.toString(2);break;case"c":g=String.fromCharCode(g);break;case"d":case"i":g=parseInt(g,10);break;case"e":g=j[7]?g.toExponential(j[7]):g.toExponential();break;case"f":g=j[7]?parseFloat(g).toFixed(j[7]):parseFloat(g);break;case"o":g=g.toString(8);break;case"s":g=(g=String(g))&&j[7]?g.substring(0,j[7]):g;break;case"u":g>>>=0;break;case"x":g=g.toString(16);break;case"X":g=g.toString(16).toUpperCase()}!e.number.test(j[8])||r&&!j[3]?s="":(s=r?"+":"-",g=g.toString().replace(e.sign,"")),l=j[4]?"0"===j[4]?"0":j[4].charAt(1):" ",m=j[6]-(s+g).length,k=j[6]&&m>0?d(l,m):"",q[q.length]=j[5]?s+g+k:"0"===l?s+k+g:k+s+g}return q.join("")},b.cache={},b.parse=function(a){for(var b=a,c=[],d=[],f=0;b;){if(null!==(c=e.text.exec(b)))d[d.length]=c[0];else if(null!==(c=e.modulo.exec(b)))d[d.length]="%";else{if(null===(c=e.placeholder.exec(b)))throw new SyntaxError("[sprintf] unexpected placeholder");if(c[2]){f|=1;var g=[],h=c[2],i=[];if(null===(i=e.key.exec(h)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(g[g.length]=i[1];""!==(h=h.substring(i[0].length));)if(null!==(i=e.key_access.exec(h)))g[g.length]=i[1];else{if(null===(i=e.index_access.exec(h)))throw new SyntaxError("[sprintf] failed to parse named argument key");g[g.length]=i[1]}c[2]=g}else f|=2;if(3===f)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");d[d.length]=c}b=b.substring(c[0].length)}return d};var f=function(a,c,d){return d=(c||[]).slice(0),d.splice(0,0,a),b.apply(null,d)};"undefined"!=typeof exports?(exports.sprintf=b,exports.vsprintf=f):(a.sprintf=b,a.vsprintf=f,"function"==typeof define&&define.amd&&define(function(){return{sprintf:b,vsprintf:f}}))}("undefined"==typeof window?this:window),function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype,f=function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}};a=!0;var g=new this;a=!1;for(var h in c)g[h]="function"==typeof c[h]&&"function"==typeof e[h]&&b.test(c[h])?f(h,c[h]):c[h];return d.prototype=g,d.prototype.constructor=d,d.extend=arguments.callee,d}}();var FacebookShareDialog=Class.extend({_shareObj:null,init:function(a){this._shareObj=a,this._shareObj.method="feed"},show:function(a,b){FB.ui(this._shareObj,function(c){void 0!==c&&(null===c?a&&a():b&&b())})}});MVCArrayBinder.prototype=new google.maps.MVCObject,MVCArrayBinder.prototype.get=function(a){return isNaN(parseInt(a))?void this.array_.get(a):this.array_.getAt(parseInt(a))},MVCArrayBinder.prototype.set=function(a,b){isNaN(parseInt(a))?this.array_.set(a,b):this.array_.setAt(parseInt(a),b)},MapEditor.prototype.bindDomEvents=function(){var a=this;document.getElementById("route-stops").addEventListener("click",function(){var b=a.markers[this.dataset.stop];google.maps.event.trigger(b,"click")}),document.getElementById("addpoint").addEventListener("click",function(){a.addmarker(),google.maps.event.trigger(a.markers[a.markers.length-1],"click")}),document.getElementById("addmeetingplace").addEventListener("click",function(){a.addMeetingPlace(),google.maps.event.trigger(a.markers[a.markers.length-1],"click")}),document.querySelector(".clear-route").addEventListener("click",function(b){var c=window.confirm("Do you want to remove your walk route? Your Stops will not be deleted.");c&&a.clearRoute(),b.preventDefault()}),document.getElementById("addroute").addEventListener("click",function(){if($(this).hasClass("active")){for($(this).html('<i class="icon-map-route"></i> Edit Route').removeClass("btn-primary active"),$(".map-notifications").html(""),$("#addpoint").prop("disabled",!1),$(".disable-alert").css({zIndex:"-1"}),google.maps.event.clearListeners(a.map,"click"),i=0;i<a.point.length;i++)a.point[i].setVisible(!1),a.point[i].setDraggable(!1);for(i=0;i<a.markers.length;i++)a.addmarkerListener(a.markers[i]),a.markers[i].setDraggable(!0);a.poly.setEditable(!1)}else{for($(this).html('<i class="icon-thumbs-up"></i> Save Route').addClass("btn-primary active"),$(".map-notifications").html('<div class="alert alert-info">Click on the map to draw your route. Right click to undo a route marker.</div>'),$("#addpoint").prop("disabled",!0),$(".disable-alert").css({zIndex:"5"}),google.maps.event.addListener(a.map,"click",function(b,c,d,e){a.addlines(b,c,d,e)}),i=0;i<a.point.length;i++)a.point[i].setVisible(!0),a.point[i].setDraggable(!0);for(i=0;i<a.markers.length;i++)google.maps.event.removeListener(a.markers[i].listener),a.markers[i].setDraggable(!1),a.markers[i].setClickable(!1);a.poly.setEditable(!0)}if(0===a.markers.length)return!1;if(a.point.length<=0){lat=a.map.getCenter().lat(),lng=a.map.getCenter().lng();var b=(new google.maps.LatLng(lat,lng),a.markers[0]),c=new google.maps.InfoWindow({content:"Click here to start your Route"});c.open(a.map,b),google.maps.event.addListenerOnce(a.map,"click",function(){c.close()})}}),google.maps.event.addListener(a.map,"resize",function(){a.centerRoute()})},MapEditor.prototype.createHomeControl=function(a){a.style.padding="5px";var b=document.createElement("div");b.style.backgroundColor="white",b.style.borderStyle="solid",b.style.borderWidth="2px",b.style.cursor="pointer",b.style.textAlign="center",b.title="Click to set the map to Home",a.appendChild(b);var c=document.createElement("div");c.style.fontFamily="Arial,sans-serif",c.style.fontSize="12px",c.style.paddingLeft="4px",c.style.paddingRight="4px",c.innerHTML="<b>Home</b>",b.appendChild(c),google.maps.event.addDomListener(b,"click",function(){navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);_this.map.setCenter(b)},function(){})})},MapEditor.prototype.pathSet=function(){for(var a=this.poly.getPath(),b=a.getLength(),c="",d=0;b>d;d++)c+=a.getAt(d).toUrlValue(6);console.log(c)},MapEditor.prototype.addMarkerListener=function(a){var b=this,c='<div class="stop-form"><input type="text" value="'+a.title+'" class="marker-title" placeholder="Title of this stop"><br><textarea class="marker-description box-sizing" placeholder="Description of this stop">'+a.description+'</textarea><br><textarea class="marker-questions box-sizing" placeholder="A few questions for participants">'+a.questions+'</textarea><br><button class="btn btn-primary" id="save-marker">Save Stop</button> <button class="btn" id="delete-marker">Delete</button></div>';b.map.panBy(0,-20),a.listener=google.maps.event.addListener(a,"click",function(){b.infowindow.setContent(c),b.infowindow.open(b.map,a),b.deleteMarkerButton(a),b.saveMarkerButton(a)})},MapEditor.prototype.updateChart=function(){$("#route-stops tbody").empty();for(var a=0;a<this.markers.length;a++)$("#route-stops tbody").append("<tr><td>"+this.markers[a].title+"</td><td>"+this.markers[a].description+'</td><td><a class="delete-stop" href="#map-canvas" data-stop='+a+">Edit</a></td></tr>")},MapEditor.prototype.addLines=function(a,b,c,d){var e,f,g=this;if(c?(e=new google.maps.LatLng(c,d),f=!1):(e=a.latLng,f=!0),b||(b="#"+i),$("#addroute").hasClass("active")||b){var h=g.poly.getPath();h.push(e);var i=h.getLength(),j=new google.maps.Marker({position:e,title:b,map:g.map,draggable:!0,icon:g.pathMarker,zIndex:100,visible:f});j.bindTo("position",g.poly.binder,(i-1).toString()),g.point.push(j),google.maps.event.addListener(j,"rightclick",function(){for(var a=0;a<g.point.length;a++)g.point[a]===g&&g.point.splice(a,1);j.setMap(null),h.removeAt(i-1)})}},MapEditor.prototype.addMeetingPlace=function(a,b,c,d,e){var f=this;d||(d=f.map.getCenter().lat()),e||(e=f.map.getCenter().lng()),b||(b=""),c||(c="");var g=new google.maps.LatLng(d,e),h=new google.maps.Marker({position:g,animation:google.maps.Animation.DROP,crossOnDrag:!0,draggable:!0,title:b,description:c,style:"meeting",icon:f.stopMarker,map:f.map}),i='<div class="stop-form"><input type="text" value="'+h.title+'" placeholder="Name of your meeting place" class="marker-title"><br><textarea class="marker-description box-sizing" placeholder="Describe where you are meeting">'+h.description+'</textarea><br><button class="btn btn-primary" id="save-marker">Save Meeting Place</button> <button class="btn" id="delete-marker">Delete</button></div>';d?(f.markers.push(h),$("#addmeetingplace").prop("disabled",!0)):(f.infowindow.setContent(i),f.infowindow.open(f.map,h)),google.maps.event.addListener(h,"click",function(){f.infowindow.setContent(i),f.map.panTo(h.getPosition()),f.infowindow.open(f.map,h),f.deleteMarkerButton(h),f.saveMarkerButton(h)})},MapEditor.prototype.addMarker=function(a,b,c,d,e,f){e||(e=this.map.getCenter().lat()),f||(f=this.map.getCenter().lng()),b||(b=""),c||(c=""),d||(d="");var g=new google.maps.LatLng(e,f),h=new google.maps.Marker({position:g,animation:google.maps.Animation.DROP,draggable:!0,title:b,icon:this.stopMarker,style:"stop",description:c,questions:d,map:this.map}),i='<div class="stop-form"><input type="text" value="'+h.title+'" placeholder="Title of this stop" class="marker-title"><br><textarea class="marker-description box-sizing" placeholder="Description of this stop">'+h.description+'</textarea><br><button class="btn btn-primary" id="save-marker">Save Stop</button> <button class="btn" id="delete-marker">Delete</button></div>';e?this.markers.push(h):(infowindow.setContent(i),infowindow.open(this.map,h)),this.addmarkerListener(h),this.updateChart()},MapEditor.prototype.saveMarkerButton=function(a){var b=this;google.maps.event.addListenerOnce(b.infowindow,"domready",function(){google.maps.event.addDomListener(document.getElementById("save-marker"),"click",function(){for(var c=0;c<b.markers.length;c++)b.markers[c]===a&&b.markers.splice(c,1);a.title=$(".marker-title").val(),a.description=$(".marker-description").val(),b.markers.push(a),$("#addmeetingplace").prop("disabled",!0),b.updateChart(),setTimeout(function(){b.infowindow.close(b.map,a)},500)})})},MapEditor.prototype.initPoly=function(){var a={strokeColor:"#F16725",strokeOpacity:.8,strokeWeight:3,editable:!1,map:this.map};this.poly=new google.maps.Polyline(a),this.poly.binder=new MVCArrayBinder(this.poly.getPath())},MapEditor.prototype.deleteMarkerButton=function(a){var b=this;google.maps.event.addListenerOnce(b.infowindow,"domready",function(){google.maps.event.addDomListener(document.getElementById("delete-marker"),"click",function(){a.setMap(null);for(var c=0;c<b.markers.length;c++)b.markers[c]===a&&b.markers.splice(c,1);$("#addmeetingplace").prop("disabled",!1),b.updateChart()})})},MapEditor.prototype.removeLines=function(){this.poly.binder.getAt(marker)},MapEditor.prototype.clearRoute=function(){this.poly.setMap(null);for(var a=0;a<this.point.length;a++)this.point[a].setMap(null);this.point=[],this.initPoly()},MapEditor.prototype.centerRoute=function(){var a=this;if(a.point.length){var b=new google.maps.LatLngBounds;for(i=0;i<a.point.length;i++)b.extend(a.point[i].position);a.map.setCenter(b.getCenter())}else a.userLocation!==!1&&a.map.setCenter(a.userLocation)};var View=Class.extend({_element:null,init:function(a){this._element=a},getElement:function(){return this._element}}),ModalView=View.extend({init:function(a){this._super(a),this._addCloseEvents()},_addCloseEvents:function(){var a=this;this._element.find(".closeModalSource").click(function(b){b.preventDefault(),a.close()})}}),PageView=View.extend({init:function(a){this._super(a),this._addNavEvents(),this._addOverlayCloseEvent()},_addOverlayCloseEvent:function(){var a=this;this._element.find(".o-background").click(function(){a._element.find(".overlay").hide()}),this._element.find("a.closeModalCta").click(function(b){b.preventDefault(),a._element.find(".overlay").hide()})},_addNavEvents:function(){this._element.find("a.search-open").click(function(){$("html, body").animate({scrollTop:0},300),$("body > header").addClass("dropped")}),this._element.find("a.search-close").click(function(){$("body > header").removeClass("dropped")})},_makeGaCall:function(a){_gaq.push(a)},trackCustomVar:function(a,b,c,d){var e=["_setCustomVar",a,b,c,d];this._makeGaCall(e)},trackEvent:function(a,b,c,d,e){var f=["_trackEvent"];void 0!==a&&f.push(a),void 0!==b&&f.push(b),void 0!==c&&f.push(c),void 0!==d&&f.push(d),this._makeGaCall(f,e)},trackView:function(a){var b=["_trackPageview",a];this._makeGaCall(b)}}),CityPageView=PageView.extend({_accessibility:null,_cards:null,_data:null,_date:null,_initiative:null,_theme:null,_ward:null,init:function(a){this._super(a),this._cards=this._element[0].querySelectorAll(".walk"),this._previewCards(),this._data=JanesWalk.walks,this._resetSelectElements(),this._addCreateWalkEvent(),this._addFilterEvents(),this._setThemeCounts(),this._captureHash(),this._addLinkListeners(),$(".walks-list .tag").tooltip()},_getFacebookDialogDonateObj:function(){return{link:"http://janeswalk.org",name:"Jane's Walk"}},_previewCards:function(){for(var a=Array.prototype.slice.call(this._cards).sort(function(){return.5-Math.random()}),b=document.querySelector(".ccm-block-page-list-walk-filters .walk-preview"),c=0,d=Math.min(a.length,9);d>c;c++){var e=a[c].cloneNode(!0);b.appendChild(e)}},_addLinkListeners:function(){var a=document.querySelector("a.see-all");a&&a.addEventListener("click",function(){document.querySelector(".ccm-block-page-list-walk-filters").classList.add("filtering"),a.parentNode.removeChild(a)})},_setupText2DonateInterstitials:function(){var a,b,c,d,e=!1,f=this,g=null!==location.pathname.match(/\/canada\/[^/]+/);this._element.find("a.closeCatfishCta").click(function(a){a.preventDefault(),f._element.find(".catfish").hide(),jQuery.cookie("hasSeenDonateCatfish","1",{path:"/",domain:location.host})}),e&&g===!0&&(a=null!==jQuery.cookie("hasSeenDonateInterstitial")&&"undefined"!=typeof jQuery.cookie("hasSeenDonateInterstitial"),a===!1?(b=function(){jQuery.cookie("hasSeenDonateInterstitial","1",{path:"/",domain:location.host}),f._element.find(".catfish.c-donate").removeClass("hidden")},this._element.find(".overlay.o-donate").show(),this._element.find(".overlay.o-donate .o-background").click(b),this._element.find("a.closeModalCta").click(b),this._element.find("div.btnWrapper a").click(function(a){jQuery.cookie("hasSeenDonateInterstitial","1",{path:"/",domain:location.host}),jQuery.cookie("hasSeenDonateCatfish","1",{path:"/",domain:location.host}),a.preventDefault(),f._element.find(".o-donate").hide(),f._element.find(".o-shout").show(),f._element.find(".o-shout .icon-twitter").click(function(a){a.preventDefault(),c=encodeURIComponent("http://janeswalk.org/"),text=encodeURIComponent($(this).closest(".option").find(".copy").text().trim()),d="https://twitter.com/intent/tweet?url="+c+"&via=janeswalk&text="+text,window.open(d,"Twitter Share","width=640, height=320")}),f._element.find(".o-shout .icon-facebook").click(function(a){a.preventDefault();var b=f._getFacebookDialogDonateObj();b.description=$(this).closest(".option").find(".copy").text().trim(),new FacebookShareDialog(b).show()})})):(hasSeenDonateCatfish=null!==jQuery.cookie("hasSeenDonateCatfish")&&"undefined"!=typeof jQuery.cookie("hasSeenDonateCatfish"),hasSeenDonateCatfish===!1&&this._element.find(".catfish").removeClass("hidden")))},_setThemeCounts:function(){var a,b=this,c=Array.prototype.forEach,d=this._element[0],e=function(c){var d=c.getAttribute("value"),e=this.compare_fn||function(a,b){return a[b]};if("*"!==d){a=0;for(var f in b._data)e(b._data[f][this.filter],d)&&++a;c.textContent+=" ("+a+")",0===a&&c.parentElement.removeChild(c)}};c.call(d.querySelectorAll('div.filters select[name="theme"] option'),e,{filter:"themes"}),c.call(d.querySelectorAll('div.filters select[name="accessibility"] option'),e,{filter:"accessibilities"}),c.call(d.querySelectorAll('div.filters select[name="ward"] option'),e,{filter:"wards"}),c.call(d.querySelectorAll('div.filters select[name="initiative"] option'),e,{filter:"initiatives"}),c.call(d.querySelectorAll('div.filters select[name="date"] option'),e,{filter:"datetimes",compare_fn:function(a,b){for(var c=0;c<a.length;c++)return-1!==a[c].date.indexOf(b)}})},_resetSelectElements:function(){var a=this;this._element.find("div.filters select").each(function(a,b){$(b).val("*")}),this._element.find(".initiatives").addClass("hidden"),this._element.find(".initiative").addClass("hidden"),this._element.find("#initiative").change(function(){"#"!==$(this).val()&&(a._element.find(".initiatives").removeClass("hidden"),a._element.find('[data-jw-initiative="'+$(this).val()+'"]').removeClass("hidden"))})},_addCreateWalkEvent:function(){var a=this,b=this._element.find(".create-walk");b.click(function(b){b.preventDefault(),0===a._element.find('a[href="/index.php/login/logout/"]').length?a._element.find(".overlay.o-connect").show():location.href=$(this).attr("href")})},_captureHash:function(){var a=this;""!==location.hash&&(pieces=location.hash.replace("#","").split("&"),key="",$(pieces).each(function(b,c){key="_"+c.split("=")[0],a[key]=c.split("=")[1]}),this._filterCards(),this._element.find('select[name="ward"]').val(this._ward),this._element.find('select[name="theme"]').val(this._theme),this._element.find('select[name="accessibility"]').val(this._accessibility),this._element.find('select[name="initiative"]').val(this._initiative),this._element.find('select[name="date"]').val(this._date))},_setHash:function(){location.hash="ward="+this._ward+"&theme="+this._theme+"&accessibility="+this._accessibility+"&initiative="+this._initiative+"&date="+this._date},_filterCards:function(){var a,b,c=this,d=0,e=function(a,b){return"*"===a||b&&b[a]};for(a=0,b=this._cards.length;b>a;a++)this._cards[a].classList.add("hidden");this._data.forEach(function(b,f){e(c._ward,b.wards)&&e(c._theme,b.themes)&&e(c._accessibility,b.accessibilities)&&e(c._initiative,b.initiatives)&&function(b,c){if("*"===c)return!0;for(a=0;a<b.length;a++)return-1!==b[a].date.indexOf(c)}(b.datetimes,c._date)&&(++d,c._cards[f].classList.remove("hidden"))}),this._element.find(".empty").addClass("hidden"),0===d&&this._element.find(".empty").removeClass("hidden")},_addFilterEvents:function(){var a=this;this._element.find("div.filters select").change(function(b){b.preventDefault(),a._ward="*",a._element.find('select[name="ward"]').length>0&&(a._ward=a._element.find('select[name="ward"]').val()),a._theme="*",a._element.find('select[name="theme"]').length>0&&(a._theme=a._element.find('select[name="theme"]').val()),a._accessibility="*",a._element.find('select[name="accessibility"]').length>0&&(a._accessibility=a._element.find('select[name="accessibility"]').val()),a._initiative="*",a._element.find('select[name="initiative"]').length>0&&(a._initiative=a._element.find('select[name="initiative"]').val()),a._date="*",a._element.find('select[name="date"]').length>0&&(a._date=a._element.find('select[name="date"]').val()),a._setHash(),a._filterCards()})}}),HomePageView=PageView.extend({init:function(a){this._super(a),this._addMapToggleEvents(),this._addCityLookup(),this._addBgImage(),this._addCityDropdownEvent(),this._addCreateWalkEvent()},_addCreateWalkEvent:function(){var a=this,b=this._element.find('.calltoaction li a[href="/walk/form/"]');b.click(function(b){b.preventDefault(),a._element.find('a[href="/index.php/login/logout/"]').length?location.href=$(this).attr("href"):a._element.find(".overlay").show()})},_addCityDropdownEvent:function(){var a=this._element.find("select.pageListSelect");a.change(function(){location.href=a.val()})},_addBgImage:function(){var a=this._element.attr("data-backgroundImageUrl"),b=this._element.find(".backgroundImageBanner"),c=document.createElement("img");c.onload=function(){b.css({backgroundImage:"url("+a+")"}),b.removeClass("faded")},c.src=a},_addCityCalloutCta:function(a,b){var c=this._element.find(".ccm-page-list-typeahead").first(),d=$("<h3 />"),e=$("<a />");e.attr({href:b}),e.text(a),d.append("See walks in ").append(e).append(", or:"),c.prepend(d)},_addCityButtonCta:function(a,b){var c=this._element.find(".calltoaction ul").first(),d=$("<li />"),e=$("<a />");d.attr({"class":"cityButtonCta"}),e.attr({"class":"btn btn-primary",href:b}),d.append(e),e.text("View walks in "+a),c.prepend(d)},_addCityLookup:function(){var a=this;window.freeGeoIpCallback=function(b){if("undefined"!=typeof b){var c=a._element.find("div.ccm-page-list-typeahead ul li a");c.each(function(c,d){$(d).text()===b.city&&(a._addCityCalloutCta(b.city,$(d).attr("href")),a._addCityButtonCta(b.city,$(d).attr("href")))})}},void 0===JanesWalk.user||void 0===JanesWalk.user.city?$.getScript("http://freegeoip.net/json/?callback=freeGeoIpCallback"):(a._addCityCalloutCta(JanesWalk.user.city.name,JanesWalk.user.city.url),a._addCityButtonCta(JanesWalk.user.city.name,JanesWalk.user.city.url))},_addMapToggleEvents:function(){var a=this._element.find(".overlap .controls a.showButton"),b=this._element.find(".overlap .controls a.closeButton");a.click(function(){$(".overlap").addClass("fullmap"),$(this).fadeOut(400,function(){b.fadeIn()}),$("html, body").animate({scrollTop:$(this).offset().top-100},800)}),b.click(function(){$(".overlap").removeClass("fullmap"),$(this).fadeOut(400,function(){a.fadeIn()})})}}),ProfilePageView=PageView.extend({_slideIndexes:{blogPost:0,city:0,walk:0},_currentTab:null,init:function(a){try{this._super(a),this._showProperStep(),this._addTabClickEvents(),this._setupDisplayPictureFlashWidget(),this._addPictureDeleteEvent(),this._addPromoteWalkClickEvent(),this._addPromoteCityClickEvent(),this._addPromoteBlogPostClickEvent(),this._setupCityPromoteModalEvents(),this._setupWalkPromoteModalEvents(),this._setupBlogPostPromoteModalEvents(),this._setupPromoteSlideshows(),this._setupTransferWalkEvents()}catch(b){console.log("Error initializing profile: "+b)}},_addPictureDeleteEvent:function(){this._element.find('a[href="/index.php/profile/delete/"]').click(function(a){a.preventDefault(),$.ajax({type:"DELETE",url:$(this).attr("href"),success:function(){location.href="/index.php/profile/#tab=picture&success=1"}})})},_addPromoteBlogPostClickEvent:function(){var a=this,b=this._element.find(".column.blogPosts .subactions .promote");b.click(function(b){b.preventDefault();var c=a._getBlogPostObjById($(this).data("blogpostid"));a._element.find(".blogPostPromoteOverlay .copy").each(function(a,b){var d=$(b);d.data("blogpostpath",c.path),d.find(".objTitle").text(c.title)}),a._element.find(".blogPostPromoteOverlay").show()})},_addPromoteCityClickEvent:function(){var a=this,b=this._element.find("#cityBlock .promoteBtn");b.click(function(b){b.preventDefault(),a._element.find(".cityPromoteOverlay").show()})},_getBlogPostObjById:function(a){var b=this._element.find('[data-blogpostid="'+a+'"]');return{title:b.first().data("blogposttitle"),path:b.first().data("blogpostpath")}},_getWalkObjById:function(a){var b=this._element.find('[data-walkid="'+a+'"]');return{title:b.first().data("walktitle"),path:b.first().data("walkpath")}},_addPromoteWalkClickEvent:function(){var a=this,b=this._element.find(".column.city .subactions .promote,.column.walks .subactions .promote");b.click(function(b){b.preventDefault();var c=a._getWalkObjById($(this).data("walkid"));a._element.find(".walkPromoteOverlay .copy").each(function(a,b){var d=$(b);d.data("walkpath",c.path),d.find(".objTitle").text(c.title)}),a._element.find(".walkPromoteOverlay").show()})},_addTabClickEvents:function(){var a=this;this._element.find("ul.nav-tabs li a").click(function(b){b.preventDefault(),a._currentTab=$(this).attr("data-tab"),a._showCurrentTab()}),this._element.find(".tabLink").click(function(b){b.preventDefault(),a._currentTab=$(this).attr("data-tab"),a._showCurrentTab()})},_setupBlogPostPromoteModalEvents:function(){var a=this;this._element.find(".blogPostPromoteOverlay").find(".icon-twitter").click(function(b){b.preventDefault();var c=$(this).closest(".option").find(".copy");a._showTwitterShareWindow("http://janeswalk.org"+c.data("blogpostpath"),c.text().trim())}),this._element.find(".blogPostPromoteOverlay").find(".icon-facebook").click(function(b){b.preventDefault();var c=$(this).closest(".option").find(".copy");a._showFacebookShareWindow("http://janeswalk.org"+c.data("blogpostpath"),"Jane's Walk",c.text().trim())}),this._element.find(".blogPostPromoteOverlay").find(".icon-envelope").click(function(b){b.preventDefault();var c=$(this).closest(".option").find(".copy");a._showEmailShareWindow("Jane's Walk in "+a._element.find("#profileWrapper").data("city"),c.text().trim())})},_setupCityPromoteModalEvents:function(){var a=this._element.find(".cityPromoteOverlay").data("citypath"),b=this._element.find(".cityPromoteOverlay").data("cityname"),c=this;this._element.find(".cityPromoteOverlay").find(".icon-twitter").click(function(b){b.preventDefault(),c._showTwitterShareWindow("http://janeswalk.org"+a,$(this).closest(".option").find(".copy").text().trim())}),this._element.find(".cityPromoteOverlay").find(".icon-facebook").click(function(b){b.preventDefault(),c._showFacebookShareWindow("http://janeswalk.org"+a,"Jane's Walk",$(this).closest(".option").find(".copy").text().trim())}),this._element.find(".cityPromoteOverlay").find(".icon-envelope").click(function(a){a.preventDefault(),c._showEmailShareWindow("Jane's Walk in "+b,$(this).closest(".option").find(".copy").text().trim())})},_setupTransferWalkEvents:function(){var a=this;this._element.find("#walk-transfer .users a").click(function(a){a.preventDefault(),$.get(this.getAttribute("href"),function(a){a.error?alert(a.error):window.location=window.location})}),this._element.find("a.transfer").removeClass("hidden").click(function(b){b.preventDefault();for(var c=a._element.find("#walk-transfer"),d=this.getAttribute("href"),e=c.find(".users a"),f=0,g=e.length;g>f;f++)e[f].setAttribute("href",d+"transfer/"+e[f].getAttribute("data-uid"));c.modal()})},_setupDisplayPictureFlashWidget:function(){window.ThumbnailBuilder_onSaveCompleted=function(){location.href="/index.php/profile/#tab=picture&success=1"};var a={bgcolor:"#ffffff",wmode:"transparent",quality:"high"},b={width:this._element.find("#flashContainer").attr("data-width"),height:this._element.find("#flashContainer").attr("data-height"),image:this._element.find("#flashContainer").attr("data-imagepath"),save:this._element.find("#flashContainer").attr("data-savepath")};"undefined"!=typeof swfobject&&swfobject.embedSWF(this._element.find("#flashContainer").attr("data-flashpath"),"flashContainer","500","400","10,0,0,0","includes/expressInstall.swf",b,a)},_showSlide:function(a){var b=this._slideIndexes[a],c=this._element.find('[data-slideshow="'+a+'"]'),d=c.find(".options .option");d.addClass("hidden"),$(d[b]).removeClass("hidden")},_setupPromoteSlideshows:function(){var a=this;this._element.find(".promoteOverlay .nav > a.left").click(function(b){b.preventDefault();{var c=$(this),d=c.data("slideshow"),e=c.closest(".promoteOverlay"),f=e.find(".options .option").length;
e.find(".options .option")}0===a._slideIndexes[d]?a._slideIndexes[d]=f-1:--a._slideIndexes[d],a._showSlide(d)}),this._element.find(".promoteOverlay .nav > a.right").click(function(b){b.preventDefault();{var c=$(this),d=c.data("slideshow"),e=c.closest(".promoteOverlay"),f=e.find(".options .option").length;e.find(".options .option")}a._slideIndexes[d]===f-1?a._slideIndexes[d]=0:++a._slideIndexes[d],a._showSlide(d)})},_setupWalkPromoteModalEvents:function(){var a=this;this._element.find(".walkPromoteOverlay").find(".icon-twitter").click(function(b){b.preventDefault();var c=$(this).closest(".option").find(".copy");a._showTwitterShareWindow("http://janeswalk.org"+c.data("walkpath"),c.text().trim())}),this._element.find(".walkPromoteOverlay").find(".icon-facebook").click(function(b){b.preventDefault();var c=$(this).closest(".option").find(".copy");a._showFacebookShareWindow("http://janeswalk.org"+c.data("walkpath"),"Jane's Walk",c.text().trim())}),this._element.find(".walkPromoteOverlay").find(".icon-envelope").click(function(b){b.preventDefault();var c=$(this).closest(".option").find(".copy");a._showEmailShareWindow("Jane's Walk in "+a._element.find("#profileWrapper").data("city"),c.text().trim())})},_showCurrentTab:function(){this._element.find("ul.nav-tabs li.active").removeClass("active"),this._element.find('ul.nav-tabs li a[data-tab="'+this._currentTab+'"]').parent().addClass("active"),this._element.find("div.content div.block").addClass("hidden"),this._element.find('div.content div.block[data-tab="'+this._currentTab+'"]').removeClass("hidden"),location.hash="tab="+this._currentTab},_showEmailShareWindow:function(a,b){a=encodeURIComponent(a),b=encodeURIComponent(b);var c="mailto:?subject="+a+"&body="+b;window.open(c)},_showFacebookShareWindow:function(a,b,c){new FacebookShareDialog({link:a,name:b,description:c}).show()},_showProperStep:function(){if(""!==location.hash){var a,b=location.hash.split("&"),c={};$(b).each(function(b,d){a=d.split("="),c[a[0].replace("#","")]=a[1]}),this._currentTab=c.tab,this._showCurrentTab(),"undefined"!=typeof c.success&&1===parseInt(c.success)&&this._element.find('div.content div.block[data-tab="'+this._currentTab+'"]').addClass("success")}},_showTwitterShareWindow:function(a,b){a=encodeURIComponent(a),b=encodeURIComponent(b),b.length>130&&(b=b.substring(0,130)+"..."),a="https://twitter.com/intent/tweet?url="+a+"&via=janeswalk&text="+b,window.open(a,"Twitter Share","width=640, height=320")}}),WalkPageView=PageView.extend({init:function(a){this._super(a),this._addFacebookDialogEvents(),this._initializeMap()},_addFacebookDialogEvents:function(){var a=this;this._element.find(".facebookShareLink").click(function(b){b.preventDefault(),a.trackEvent("Walk","share.attempted","facebook");var c=a._getFacebookDialogObj();new FacebookShareDialog(c).show(a._facebookShareFailed,a._facebookShareSuccessful)})},_facebookShareFailed:function(){this.trackEvent("Walk","share.failed","facebook")},_facebookShareSuccessful:function(){this.trackEvent("Walk","share.successful","facebook")},_getFacebookDialogObj:function(){return{link:JanesWalk.page.url,picture:JanesWalk.page.pictureUrl,name:JanesWalk.page.title,description:JanesWalk.page.description,actions:{name:"View Jane's Walks in "+JanesWalk.page.city.name,link:JanesWalk.page.city.url}}},_styledMap:new google.maps.StyledMapType([{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"on"},{saturation:-100}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{saturation:-100}]},{featureType:"landscape.natural",stylers:[{saturation:-100},{lightness:36}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{visibility:"on"},{saturation:37}]},{featureType:"landscape.man_made",stylers:[{saturation:-100}]}],{name:"Styled Map"}),_initializeMap:function(){var a,b,c,d,e=[],f="undefined"==typeof zoomLevelset?16:zoomLevelset,g={zoom:f,scrollwheel:!1,zoomControl:!0,disableDefaultUI:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}},h=new google.maps.Map(document.getElementById("map-canvas"),g),i=[],j="../../../../img/marker.png",k=new google.maps.InfoWindow({maxWidth:300}),l=new InfoBox({content:document.getElementById("infobox"),maxWidth:150,pixelOffset:new google.maps.Size(-3,-25),alignBottom:!0,boxStyle:{background:"#fff",width:"280px",padding:"10px",border:"1px solid #eee"},closeBoxMargin:"-22px -22px 2px -8px",closeBoxURL:"../../../../img/map-close.png",infoBoxClearance:new google.maps.Size(20,20)}),m=function(a,b,c){return function(){for(var d=0;d<e.length;d++)e[d].setIcon(o);h.panTo(a.getPosition()),this.setIcon(n),k.setContent(React.renderToStaticMarkup(React.createElement("div",null,React.createElement("h4",null,JanesWalk.page.gmap.markers[b].title),React.createElement("p",null,JanesWalk.page.gmap.markers[b].description),c))),l.open(h,a),$(".walk-stop").removeClass("active"),$(".walk-stops-meta #"+b).addClass("active");$(".active");$(".walk-stops-meta").mCustomScrollbar("scrollTo",".active")}},n=new google.maps.MarkerImage("../../../../img/marker-active.png"),o=new google.maps.MarkerImage("../../../../img/marker.png");for(b in JanesWalk.page.gmap.route)i.push(new google.maps.LatLng(JanesWalk.page.gmap.route[b].lat,JanesWalk.page.gmap.route[b].lng));a=new google.maps.Polyline({path:i,strokeColor:"#F16725",strokeOpacity:.8,strokeWeight:4}),a.setMap(h),h.mapTypes.set("map_style",this._styledMap),h.setMapTypeId("map_style");for(var p in JanesWalk.page.gmap.markers)marker=new google.maps.Marker({position:new google.maps.LatLng(JanesWalk.page.gmap.markers[p].lat,JanesWalk.page.gmap.markers[p].lng),map:h,icon:j,id:p}),e.push(marker),d="",$("body").hasClass("create-page")&&(d=React.createElement("button",{className:"btn pull-right",id:"delete-marker"},React.createElement("i",{className:"fa fa-trash"}))),google.maps.event.addListener(marker,"click",m(marker,p,d));$(".walk-stops").show();var q=new google.maps.LatLngBounds;for(c in e)q.extend(e[c].getPosition());for(c in a.getPath().getArray())q.extend(a.getPath().getAt(c));e.length>0&&h.fitBounds(q),google.maps.event.addListenerOnce(h,"zoom_changed",function(){var a=h.getZoom();h.setZoom(Math.min(16,a))}),google.maps.event.addDomListener(document.getElementById("map-canvas"),"touchstart",function(){h.setOptions({panControl:!1,draggable:!1})}),google.maps.event.addListener(marker,"dragend",function(){var a=marker.getPosition();h.panTo(a),document.getElementById("txt_latlng").value=a.lat()+", "+a.lng()}),google.maps.event.addListenerOnce(k,"domready",function(){google.maps.event.addDomListener(document.getElementById("save-marker"),"click",function(){k.close(h,marker)})}),$(".walk-stop").on("click",function(){marker=e[this.id],$(".walk-stop").removeClass("active"),$(this).addClass("active"),google.maps.event.trigger(marker,"click")})}});document.addEventListener("DOMContentLoaded",function(){var a=document.body.getAttribute("data-pageViewName");if(a)try{new window[a]($(document.body))}catch(b){console.log("Error instantiating page view "+a+": "+b)}else console.log("No page view defined.");var c=document.getElementById("ccm-toolbar");c&&window.addEventListener("keyup",function(a){if("INPUT"!==a.target.tagName)switch(a.preventDefault(),String(a.key||a.keyCode&&String.fromCharCode(a.keyCode)||a.char).toUpperCase()){case"M":c.style&&(c.style.zIndex=99999==c.style.zIndex?-1:99999)}})});