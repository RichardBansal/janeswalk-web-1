function toStandardTime(e){timeArray=e.split(":");var t,n;return 12==timeArray[0]?(t=12,n="pm"):timeArray[0]>12?(t=timeArray[0]-12,n="pm"):(t=timeArray[0],n="am"),t=t+":"+timeArray[1]+n}function blurPage(){$("body > section, body > header").addClass("blur")}function unblurPage(){$("body > section, body > header").removeClass("blur")}if(function(){var e=!1,t=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function a(){!e&&this.init&&this.init.apply(this,arguments)}var i=this.prototype;e=!0;var o=new this;e=!1;for(var s in n)o[s]="function"==typeof n[s]&&"function"==typeof i[s]&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=i[e];var a=t.apply(this,arguments);return this._super=n,a}}(s,n[s]):n[s];return a.prototype=o,a.prototype.constructor=a,a.extend=arguments.callee,a}}(),Function.prototype.bind||(Function.prototype.bind=function(e){"use strict";if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,a=function(){},i=function(){return n.apply(this instanceof a&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,i.prototype=new a,i}),function(){"use strict";var e=Object.prototype,t=e.__defineGetter__,n=e.__defineSetter__,a=e.__lookupGetter__,i=e.__lookupSetter__,o=e.hasOwnProperty;t&&n&&a&&i&&(Object.defineProperty||(Object.defineProperty=function(e,s,r){if(arguments.length<3)throw new TypeError("Arguments not optional");if(s+="",o.call(r,"value")&&(!a.call(e,s)&&!i.call(e,s)&&(e[s]=r.value),o.call(r,"get")||o.call(r,"set")))throw new TypeError("Cannot specify an accessor and a value");if(!(r.writable&&r.enumerable&&r.configurable))throw new TypeError("This implementation of Object.defineProperty does not support false for configurable, enumerable, or writable.");return r.get&&t.call(e,s,r.get),r.set&&n.call(e,s,r.set),e}),Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(e,t){if(arguments.length<2)throw new TypeError("Arguments not optional.");t+="";var n={configurable:!0,enumerable:!0,writable:!0},s=a.call(e,t),r=i.call(e,t);return o.call(e,t)?s||r?(delete n.writable,n.get=n.set=void 0,s&&(n.get=s),r&&(n.set=r),n):(n.value=e[t],n):n}),Object.defineProperties||(Object.defineProperties=function(e,t){var n;for(n in t)o.call(t,n)&&Object.defineProperty(e,n,t[n])}))}(),!(document.documentElement.dataset||Object.getOwnPropertyDescriptor(Element.prototype,"dataset")&&Object.getOwnPropertyDescriptor(Element.prototype,"dataset").get)){var propDescriptor={enumerable:!0,get:function(){"use strict";var e,t,n,a,i,o,s=this,r=this.attributes,l=r.length,c=function(e){return e.charAt(1).toUpperCase()},d=function(){return this},f=function(e,t){return"undefined"!=typeof t?this.setAttribute(e,t):this.removeAttribute(e)};try{({}).__defineGetter__("test",function(){}),t={}}catch(h){t=document.createElement("div")}for(e=0;l>e;e++)if(o=r[e],o&&o.name&&/^data-\w[\w\-]*$/.test(o.name)){n=o.value,a=o.name,i=a.substr(5).replace(/-./g,c);try{Object.defineProperty(t,i,{enumerable:this.enumerable,get:d.bind(n||""),set:f.bind(s,a)})}catch(p){t[i]=n}}return t}};try{Object.defineProperty(Element.prototype,"dataset",propDescriptor)}catch(e){propDescriptor.enumerable=!1,Object.defineProperty(Element.prototype,"dataset",propDescriptor)}}var _pageView;$(document).ready(function(){function e(){$month.html(i.getMonthName()),$year.html(i.getYear())}function t(e){$(".caption .book").remove(),$(".caption .request-btn-book").remove(),$(".request").slideUp(),$(".request-btn").removeClass("active"),$(".date-caption").append(e.html())}var n=$("body").first(),a=n.attr("data-pageViewName");"undefined"==typeof a?console&&console.log("No page view defined."):_pageView=new window[a](n);var i=$("#calendar").calendario({displayWeekAbbr:!0,startIn:0,onDayClick:function(e,n,a){$(".fc-row div").removeClass("selected"),e.addClass("selected"),n.length>0?($(".request-btn, .request-nowalks").hide(),t(n,a)):($(".caption .book").remove(),$(".caption .request-btn-book").remove(),$(".request-nowalks, .request-btn").show()),$("body").hasClass("create-page")&&$("#selected-day").html(a.monthname+" "+a.day+", "+a.year)}});if(($("body").hasClass("walk-page")||$("body").hasClass("create-page"))&&($month=$("#custom-month").html(i.getMonthName()),$year=$("#custom-year").html(i.getYear())),$("#custom-next").on("click",function(){i.gotoNextMonth(e)}),$("#custom-prev").on("click",function(){i.gotoPreviousMonth(e)}),$(".fc-content").tooltip({trigger:"hover",title:"I'm available"}),$(".tag").tooltip({trigger:"hover",placement:"bottom"}),$(".date-caption").delegate(".request-btn-book, .request-btn","click",function(e){e.preventDefault(),$(this).toggleClass("active"),$(".request").slideToggle()}),$(".walk-stops-meta").mCustomScrollbar({theme:"dark"}),$("#step-add-button-final").on("click",function(){$("#step-add-button").animate({opacity:"1"})}),$(".notification").on("click",function(){$(this).removeClass("expanded")}),$("body").hasClass("city-page")&&"undefined"==typeof festivalWeekendCheck&&(setTimeout(function(){$(".notification.festival-weekend").addClass("expanded")},2e3),$(".city-page").on("click",function(){$(".notification.festival-weekend").removeClass("expanded")})),$("body").hasClass("home")&&setTimeout(function(){$("#prototype").modal("show")},2e3),$(".custom-walk-page .container-outter .notify").on("click",function(e){e.preventDefault(),$(".notification.custom-form").toggleClass("expanded")}),$("body").on("mousedown",function(){$(".notification").hasClass("expanded")&&$(".notification").removeClass("expanded")}),$(".bottom-bar").on("click",function(e){e.preventDefault(),$("html, body").animate({scrollTop:$("#walk-leader-bio").offset().top-80},1e3)}),$("#register-btn").on("click",function(e){e.preventDefault(),$("html, body").animate({scrollTop:$("#register").offset().top-80},1e3,function(){setTimeout(function(){$("#register").addClass("focus")},100)})}),$("body").hasClass("reg-confirmation")){var o=url("?eid"),s=url("?oid");document.getElementById("button-regdonate").href="http://janeswalk.tv/confirm?event_id="+o+"&order_id="+s}else if($("body").hasClass("reg-confirmation-riverside-walk")){var o=url("?eid"),s=url("?oid");document.getElementById("button-regdonate").href="http://janeswalk.tv/confirm-riverside?event_id="+o+"&order_id="+s}else if($("body").hasClass("reg-confirmation-congested")){var o=url("?eid"),s=url("?oid");document.getElementById("button-regdonate").href="http://janeswalk.tv/confirm-congested?event_id="+o+"&order_id="+s}});var FacebookShareDialog=Class.extend({_shareObj:null,init:function(e){this._shareObj=e,this._shareObj.method="feed"},show:function(e,t){FB.ui(this._shareObj,function(n){"undefined"!=typeof n&&(null===n?e&&e():t&&t())})}}),View=Class.extend({_element:null,init:function(e){this._element=e},getElement:function(){return this._element}}),PageView=View.extend({init:function(e){this._super(e),this._addNavEvents(),this._addOverlayCloseEvent()},_addOverlayCloseEvent:function(){var e=this;this._element.find(".o-background").click(function(){e._element.find(".overlay").hide()}),this._element.find("a.closeModalCta").click(function(t){t.preventDefault(),e._element.find(".overlay").hide()})},_addNavEvents:function(){this._element.find("a.search-open").click(function(){$("html, body").animate({scrollTop:0},300),$("header.navbar").addClass("dropped")}),this._element.find("a.search-close").click(function(){$("header.navbar").removeClass("dropped")})},_makeGaCall:function(e){_gaq.push(e)},trackCustomVar:function(e,t,n,a){var i=["_setCustomVar",e,t,n,a];this._makeGaCall(i)},trackEvent:function(e,t,n,a,i){var o=["_trackEvent"];"undefined"!=typeof e&&o.push(e),"undefined"!=typeof t&&o.push(t),"undefined"!=typeof n&&o.push(n),"undefined"!=typeof a&&o.push(a),this._makeGaCall(o,i)},trackView:function(e){var t=["_trackPageview",e];this._makeGaCall(t)}}),ModalView=View.extend({init:function(e){this._super(e),this._addCloseEvents()},_addCloseEvents:function(){var e=this;this._element.find(".closeModalSource").click(function(t){t.preventDefault(),e.close()})}}),CityPageView=PageView.extend({_accessibility:null,_cards:null,_data:null,_date:null,_initiative:null,_theme:null,_ward:null,init:function(e){this._super(e),this._cards=this._element[0].querySelectorAll(".walk"),this._previewCards(),this._data=JanesWalk.walks,this._resetSelectElements(),this._addCreateWalkEvent(),this._addFilterEvents(),this._setThemeCounts(),this._captureHash(),this._addLinkListeners()},_getFacebookDialogDonateObj:function(){return{link:"http://janeswalk.org",name:"Jane's Walk"}},_previewCards:function(){for(var e=Array.prototype.slice.call(this._cards).sort(function(){return.5-Math.random()}),t=document.querySelector(".walks-list.preview div"),n=0,a=Math.min(e.length,9);a>n;n++){var i=e[n].cloneNode(!0);i.classList.add("col-md-4"),i.classList.remove("col-md-3"),t.appendChild(i)}},_addLinkListeners:function(){var e=document.querySelector("a.see-all");e&&e.addEventListener("click",function(){var e=[this,document.querySelector(".walk-preview.action-items"),document.querySelector(".walks-list.preview")],t=document.querySelector(".walks-list.showall");e.forEach(function(e){try{e.classList.remove("in")}catch(e){console.log("Error fading out menu: "+e)}}),e.forEach(function(e){e.style.width=0,e.style.padding=0,e.style.margin=0}),setTimeout(function(){e.forEach(function(e){e.style.display="none"}),t.classList.remove("hide"),t.classList.add("in")},300)})},_setupText2DonateInterstitials:function(){var e=!1;this._element.find("a.closeCatfishCta").click(function(e){e.preventDefault(),n._element.find(".catfish").hide(),jQuery.cookie("hasSeenDonateCatfish","1",{path:"/",domain:location.host})});var t=null!==location.pathname.match(/\/canada\/[^/]+/),n=this;if(e&&t===!0){var a=null!==jQuery.cookie("hasSeenDonateInterstitial")&&"undefined"!=typeof jQuery.cookie("hasSeenDonateInterstitial");if(a===!1){var i=function(){jQuery.cookie("hasSeenDonateInterstitial","1",{path:"/",domain:location.host}),n._element.find(".catfish.c-donate").removeClass("hidden")};this._element.find(".overlay.o-donate").show(),this._element.find(".overlay.o-donate .o-background").click(i),this._element.find("a.closeModalCta").click(i),this._element.find("div.btnWrapper a").click(function(e){jQuery.cookie("hasSeenDonateInterstitial","1",{path:"/",domain:location.host}),jQuery.cookie("hasSeenDonateCatfish","1",{path:"/",domain:location.host}),e.preventDefault(),n._element.find(".o-donate").hide(),n._element.find(".o-shout").show(),n._element.find(".o-shout .icon-twitter").click(function(e){e.preventDefault();var t=encodeURIComponent("http://janeswalk.org/"),n=encodeURIComponent($(this).closest(".option").find(".copy").text().trim()),a="https://twitter.com/intent/tweet?url="+t+"&via=janeswalk&text="+n;window.open(a,"Twitter Share","width=640, height=320")}),n._element.find(".o-shout .icon-facebook").click(function(e){e.preventDefault();var t=n._getFacebookDialogDonateObj();t.description=$(this).closest(".option").find(".copy").text().trim(),new FacebookShareDialog(t).show()})})}else{var o=null!==jQuery.cookie("hasSeenDonateCatfish")&&"undefined"!=typeof jQuery.cookie("hasSeenDonateCatfish");o===!1&&this._element.find(".catfish").removeClass("hidden")}}},_setThemeCounts:function(){var e,t=this,n=this._element[0],a=function(n){var a=n.getAttribute("value"),i=this.compare_fn||function(e,t){return e[t]};if("*"!==a){e=0;for(var o in t._data)i(t._data[o][this.filter],a)&&++e;n.textContent+=" ("+e+")",0===e&&n.parentElement.removeChild(n)}};Array.prototype.forEach.call(n.querySelectorAll('div.filters select[name="theme"] option'),a,{filter:"themes"}),Array.prototype.forEach.call(n.querySelectorAll('div.filters select[name="accessibility"] option'),a,{filter:"accessibilities"}),Array.prototype.forEach.call(n.querySelectorAll('div.filters select[name="ward"] option'),a,{filter:"wards"}),Array.prototype.forEach.call(n.querySelectorAll('div.filters select[name="initiative"] option'),a,{filter:"initiatives"}),Array.prototype.forEach.call(n.querySelectorAll('div.filters select[name="date"] option'),a,{filter:"datetimes",compare_fn:function(e,t){for(var n=0;n<e.length;n++)return-1!==e[n].date.indexOf(t)}})},_resetSelectElements:function(){this._element.find("div.filters select").each(function(e,t){$(t).val("*")});var e=this;this._element.find(".initiatives").addClass("hidden"),this._element.find(".initiative").addClass("hidden"),this._element.find("#initiative").change(function(){"#"!==$(this).val()&&(e._element.find(".initiatives").removeClass("hidden"),e._element.find('[data-jw-initiative="'+$(this).val()+'"]').removeClass("hidden"))})},_addCreateWalkEvent:function(){var e=this,t=this._element.find(".create-walk");t.click(function(t){t.preventDefault(),0===e._element.find('a[href="/index.php/login/logout/"]').length?e._element.find(".overlay.o-connect").show():location.href=$(this).attr("href")})},_captureHash:function(){if(""!==location.hash){var e=this,t=location.hash.replace("#","").split("&"),n="";$(t).each(function(t,a){n="_"+a.split("=")[0],e[n]=a.split("=")[1]}),this._filterCards(),this._element.find('select[name="ward"]').val(this._ward),this._element.find('select[name="theme"]').val(this._theme),this._element.find('select[name="accessibility"]').val(this._accessibility),this._element.find('select[name="initiative"]').val(this._initiative),this._element.find('select[name="date"]').val(this._date)}},_setHash:function(){location.hash="ward="+this._ward+"&theme="+this._theme+"&accessibility="+this._accessibility+"&initiative="+this._initiative+"&date="+this._date},_filterCards:function(){for(var e=this,t=0,n=function(e,t){return"*"===e||t&&t[e]},a=0,i=this._cards.length;i>a;a++)this._cards[a].classList.add("hidden");this._data.forEach(function(a,i){n(e._ward,a.wards)&&n(e._theme,a.themes)&&n(e._accessibility,a.accessibilities)&&n(e._initiative,a.initiatives)&&function(e,t){if("*"===t)return!0;for(var n=0;n<e.length;n++)return-1!==e[n].date.indexOf(t)}(a.datetimes,e._date)&&(++t,e._cards[i].classList.remove("hidden"))}),this._element.find(".empty").addClass("hidden"),0===t&&this._element.find(".empty").removeClass("hidden")},_addFilterEvents:function(){var e=this;this._element.find("div.filters select").change(function(t){t.preventDefault(),e._ward="*",e._element.find('select[name="ward"]').length>0&&(e._ward=e._element.find('select[name="ward"]').val()),e._theme="*",e._element.find('select[name="theme"]').length>0&&(e._theme=e._element.find('select[name="theme"]').val()),e._accessibility="*",e._element.find('select[name="accessibility"]').length>0&&(e._accessibility=e._element.find('select[name="accessibility"]').val()),e._initiative="*",e._element.find('select[name="initiative"]').length>0&&(e._initiative=e._element.find('select[name="initiative"]').val()),e._date="*",e._element.find('select[name="date"]').length>0&&(e._date=e._element.find('select[name="date"]').val()),e._setHash(),e._filterCards()})}}),WalkPageView=PageView.extend({init:function(e){this._super(e),this._addFacebookDialogEvents(),this._initializeMap()},_addFacebookDialogEvents:function(){var e=this;this._element.find(".facebookShareLink").click(function(t){t.preventDefault(),e.trackEvent("Walk","share.attempted","facebook");var n=e._getFacebookDialogObj();new FacebookShareDialog(n).show(e._facebookShareFailed,e._facebookShareSuccessful)})},_facebookShareFailed:function(){this.trackEvent("Walk","share.failed","facebook")},_facebookShareSuccessful:function(){this.trackEvent("Walk","share.successful","facebook")},_getFacebookDialogObj:function(){return{link:JanesWalk.page.url,picture:JanesWalk.page.pictureUrl,name:JanesWalk.page.title,description:JanesWalk.page.description,actions:{name:"View Jane's Walks in "+JanesWalk.page.city.name,link:JanesWalk.page.city.url}}},_styledMap:new google.maps.StyledMapType([{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"on"},{saturation:-100}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{saturation:-100}]},{featureType:"landscape.natural",stylers:[{saturation:-100},{lightness:36}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{visibility:"on"},{saturation:37}]},{featureType:"landscape.man_made",stylers:[{saturation:-100}]}],{name:"Styled Map"}),_initializeMap:function(){if(markers=new Array,"undefined"!=typeof zoomLevelset)var e=zoomLevelset;else var e=16;var t={zoom:e,scrollwheel:!1,zoomControl:!0,disableDefaultUI:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}},n=new google.maps.Map(document.getElementById("map-canvas"),t),a=[];for(var i in JanesWalk.page.gmap.route)a.push(new google.maps.LatLng(JanesWalk.page.gmap.route[i].lat,JanesWalk.page.gmap.route[i].lng));var o=new google.maps.Polyline({path:a,strokeColor:"#F16725",strokeOpacity:.8,strokeWeight:4});o.setMap(n),n.mapTypes.set("map_style",this._styledMap),n.setMapTypeId("map_style");var s="../../../../img/marker.png",r=new google.maps.InfoWindow({maxWidth:300}),l=new InfoBox({content:document.getElementById("infobox"),maxWidth:150,pixelOffset:new google.maps.Size(-3,-25),alignBottom:!0,boxStyle:{background:"#fff",width:"280px",padding:"10px",border:"1px solid #eee"},closeBoxMargin:"-22px -22px 2px -8px",closeBoxURL:"../../../../img/map-close.png",infoBoxClearance:new google.maps.Size(20,20)});for(var c in JanesWalk.page.gmap.markers){marker=new google.maps.Marker({position:new google.maps.LatLng(JanesWalk.page.gmap.markers[c].lat,JanesWalk.page.gmap.markers[c].lng),map:n,icon:s,id:c}),markers.push(marker);var d="";if($("body").hasClass("create-page"))var d="<button class='btn pull-right' id='delete-marker'><i class='icon-trash'><i></button>";var f=new google.maps.MarkerImage("../../../../img/marker-active.png"),h=new google.maps.MarkerImage("../../../../img/marker.png");google.maps.event.addListener(marker,"click",function(e,t){return function(){for(var a=0;a<markers.length;a++)markers[a].setIcon(h);n.panTo(e.getPosition()),this.setIcon(f),r.setContent("<h4>"+JanesWalk.page.gmap.markers[t].title+"</h4><p>"+JanesWalk.page.gmap.markers[t].description+"</p>"+d),l.setContent("<h4>"+JanesWalk.page.gmap.markers[t].title+"</h4><p>"+JanesWalk.page.gmap.markers[t].description+"</p>"+d),l.open(n,e),$(".walk-stop").removeClass("active"),$(".walk-stops-meta #"+t).addClass("active");$(".active");$(".walk-stops-meta").mCustomScrollbar("scrollTo",".active")}}(marker,c))}$(".walk-stops").show();var p=new google.maps.LatLngBounds;for(var u in markers)p.extend(markers[u].getPosition());for(var u in o.getPath().getArray())p.extend(o.getPath().getAt(u));markers.length>0&&n.fitBounds(p),google.maps.event.addListenerOnce(n,"zoom_changed",function(){var e=n.getZoom();n.setZoom(Math.min(16,e))}),google.maps.event.addDomListener(document.getElementById("map-canvas"),"touchstart",function(){n.setOptions({panControl:!1,draggable:!1})}),google.maps.event.addListener(marker,"dragend",function(){var e=marker.getPosition();n.panTo(e),document.getElementById("txt_latlng").value=e.lat()+", "+e.lng()}),google.maps.event.addListenerOnce(r,"domready",function(){google.maps.event.addDomListener(document.getElementById("save-marker"),"click",function(){r.close(n,marker)})}),$(".walk-stop").on("click",function(){marker=markers[this.id],$(".walk-stop").removeClass("active"),$(this).addClass("active"),google.maps.event.trigger(marker,"click")})}}),ProfilePageView=PageView.extend({_slideIndexes:{blogPost:0,city:0,walk:0},_currentTab:null,init:function(e){try{this._super(e),this._showProperStep(),this._addTabClickEvents(),this._setupDisplayPictureFlashWidget(),this._addPictureDeleteEvent(),this._addPromoteWalkClickEvent(),this._addPromoteCityClickEvent(),this._addPromoteBlogPostClickEvent(),this._setupCityPromoteModalEvents(),this._setupWalkPromoteModalEvents(),this._setupBlogPostPromoteModalEvents(),this._setupPromoteSlideshows()}catch(t){console.log("Error initializing profile: "+t)}},_addPictureDeleteEvent:function(){this._element.find('a[href="/index.php/profile/delete/"]').click(function(e){e.preventDefault(),$.ajax({type:"DELETE",url:$(this).attr("href"),success:function(){location.href="/index.php/profile/#tab=picture&success=1"}})})},_addPromoteBlogPostClickEvent:function(){var e=this,t=this._element.find(".column.blogPosts .subactions .promote");t.click(function(t){t.preventDefault();var n=e._getBlogPostObjById($(this).data("blogpostid"));e._element.find(".blogPostPromoteOverlay .copy").each(function(e,t){var a=$(t);a.data("blogpostpath",n.path),a.find(".objTitle").text(n.title)}),e._element.find(".blogPostPromoteOverlay").show()})},_addPromoteCityClickEvent:function(){var e=this,t=this._element.find("#cityBlock .promoteBtn");t.click(function(t){t.preventDefault(),e._element.find(".cityPromoteOverlay").show()})},_getBlogPostObjById:function(e){var t=this._element.find('[data-blogpostid="'+e+'"]');return{title:t.first().data("blogposttitle"),path:t.first().data("blogpostpath")}},_getWalkObjById:function(e){var t=this._element.find('[data-walkid="'+e+'"]');return{title:t.first().data("walktitle"),path:t.first().data("walkpath")}},_addPromoteWalkClickEvent:function(){var e=this,t=this._element.find(".column.city .subactions .promote,.column.walks .subactions .promote");t.click(function(t){t.preventDefault();var n=e._getWalkObjById($(this).data("walkid"));e._element.find(".walkPromoteOverlay .copy").each(function(e,t){var a=$(t);a.data("walkpath",n.path),a.find(".objTitle").text(n.title)}),e._element.find(".walkPromoteOverlay").show()})},_addTabClickEvents:function(){var e=this;this._element.find("ul.nav-tabs li a").click(function(t){t.preventDefault(),e._currentTab=$(this).attr("data-tab"),e._showCurrentTab()}),this._element.find(".tabLink").click(function(t){t.preventDefault(),e._currentTab=$(this).attr("data-tab"),e._showCurrentTab()})},_setupBlogPostPromoteModalEvents:function(){var e=this;this._element.find(".blogPostPromoteOverlay").find(".icon-twitter").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showTwitterShareWindow("http://janeswalk.org"+n.data("blogpostpath"),n.text().trim())}),this._element.find(".blogPostPromoteOverlay").find(".icon-facebook").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showFacebookShareWindow("http://janeswalk.org"+n.data("blogpostpath"),"Jane's Walk",n.text().trim())}),this._element.find(".blogPostPromoteOverlay").find(".icon-envelope").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showEmailShareWindow("Jane's Walk in "+e._element.find("#profileWrapper").data("city"),n.text().trim())})},_setupCityPromoteModalEvents:function(){var e=this._element.find(".cityPromoteOverlay").data("citypath"),t=this._element.find(".cityPromoteOverlay").data("cityname"),n=this;this._element.find(".cityPromoteOverlay").find(".icon-twitter").click(function(t){t.preventDefault(),n._showTwitterShareWindow("http://janeswalk.org"+e,$(this).closest(".option").find(".copy").text().trim())}),this._element.find(".cityPromoteOverlay").find(".icon-facebook").click(function(t){t.preventDefault(),n._showFacebookShareWindow("http://janeswalk.org"+e,"Jane's Walk",$(this).closest(".option").find(".copy").text().trim())}),this._element.find(".cityPromoteOverlay").find(".icon-envelope").click(function(e){e.preventDefault(),n._showEmailShareWindow("Jane's Walk in "+t,$(this).closest(".option").find(".copy").text().trim())})},_setupDisplayPictureFlashWidget:function(){window.ThumbnailBuilder_onSaveCompleted=function(){location.href="/index.php/profile/#tab=picture&success=1"};var e={bgcolor:"#ffffff",wmode:"transparent",quality:"high"},t={width:this._element.find("#flashContainer").attr("data-width"),height:this._element.find("#flashContainer").attr("data-height"),image:this._element.find("#flashContainer").attr("data-imagepath"),save:this._element.find("#flashContainer").attr("data-savepath")};"undefined"!=typeof swfobject&&swfobject.embedSWF(this._element.find("#flashContainer").attr("data-flashpath"),"flashContainer","500","400","10,0,0,0","includes/expressInstall.swf",t,e)},_showSlide:function(e){var t=this._slideIndexes[e],n=this._element.find('[data-slideshow="'+e+'"]'),a=n.find(".options .option");a.addClass("hidden"),$(a[t]).removeClass("hidden")},_setupPromoteSlideshows:function(){var e=this;this._element.find(".promoteOverlay .nav > a.left").click(function(t){t.preventDefault();{var n=$(this),a=n.data("slideshow"),i=n.closest(".promoteOverlay"),o=i.find(".options .option").length;i.find(".options .option")}0===e._slideIndexes[a]?e._slideIndexes[a]=o-1:--e._slideIndexes[a],e._showSlide(a)}),this._element.find(".promoteOverlay .nav > a.right").click(function(t){t.preventDefault();{var n=$(this),a=n.data("slideshow"),i=n.closest(".promoteOverlay"),o=i.find(".options .option").length;i.find(".options .option")}e._slideIndexes[a]===o-1?e._slideIndexes[a]=0:++e._slideIndexes[a],e._showSlide(a)})},_setupWalkPromoteModalEvents:function(){var e=this;this._element.find(".walkPromoteOverlay").find(".icon-twitter").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showTwitterShareWindow("http://janeswalk.org"+n.data("walkpath"),n.text().trim())}),this._element.find(".walkPromoteOverlay").find(".icon-facebook").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showFacebookShareWindow("http://janeswalk.org"+n.data("walkpath"),"Jane's Walk",n.text().trim())}),this._element.find(".walkPromoteOverlay").find(".icon-envelope").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showEmailShareWindow("Jane's Walk in "+e._element.find("#profileWrapper").data("city"),n.text().trim())})},_showCurrentTab:function(){this._element.find("ul.nav-tabs li.active").removeClass("active"),this._element.find('ul.nav-tabs li a[data-tab="'+this._currentTab+'"]').parent().addClass("active"),this._element.find("div.content div.block").addClass("hidden"),this._element.find('div.content div.block[data-tab="'+this._currentTab+'"]').removeClass("hidden"),location.hash="tab="+this._currentTab},_showEmailShareWindow:function(e,t){e=encodeURIComponent(e),t=encodeURIComponent(t);var n="mailto:?subject="+e+"&body="+t;window.open(n)},_showFacebookShareWindow:function(e,t,n){new FacebookShareDialog({link:e,name:t,description:n}).show()},_showProperStep:function(){if(""!==location.hash){var e,t=location.hash.split("&"),n={};$(t).each(function(t,a){e=a.split("="),n[e[0].replace("#","")]=e[1]}),this._currentTab=n.tab,this._showCurrentTab(),"undefined"!=typeof n.success&&1===parseInt(n.success)&&this._element.find('div.content div.block[data-tab="'+this._currentTab+'"]').addClass("success")}},_showTwitterShareWindow:function(e,t){e=encodeURIComponent(e),t=encodeURIComponent(t),t.length>130&&(t=t.substring(0,130)+"...");var e="https://twitter.com/intent/tweet?url="+e+"&via=janeswalk&text="+t;window.open(e,"Twitter Share","width=640, height=320")}}),HomePageView=PageView.extend({init:function(e){this._super(e),this._addMapToggleEvents(),this._addCityLookup(),this._addBgImage(),this._addCityDropdownEvent(),this._addCreateWalkEvent()},_addCreateWalkEvent:function(){var e=this,t=this._element.find('.calltoaction li a[href="/walk/form/"]');t.click(function(t){t.preventDefault(),0===e._element.find('a[href="/index.php/login/logout/"]').length?e._element.find(".overlay").show():location.href=$(this).attr("href")})},_addCityDropdownEvent:function(){var e=this._element.find("select.pageListSelect");e.change(function(){location.href=e.val()})},_addBgImage:function(){var e=this._element.attr("data-backgroundImageUrl"),t=this._element.find(".backgroundImageBanner"),n=document.createElement("img");n.onload=function(){t.css({backgroundImage:"url("+e+")"}),t.removeClass("faded")},n.src=e},_addCityCalloutCta:function(e,t){var n=this._element.find(".ccm-page-list-typeahead").first(),a=$("<h3 />"),i=$("<a />");i.attr({href:t}),i.text(e),a.append("See walks in ").append(i).append(", or:"),n.prepend(a)},_addCityButtonCta:function(e,t){var n=this._element.find(".calltoaction ul").first(),a=$("<li />"),i=$("<a />");a.attr({"class":"cityButtonCta"}),i.attr({"class":"btn btn-primary",href:t}),a.append(i),i.text("View walks in "+e),n.prepend(a)},_addCityLookup:function(){var e=this;window.freeGeoIpCallback=function(t){if("undefined"!=typeof t){var n=e._element.find("div.ccm-page-list-typeahead ul li a");n.each(function(n,a){$(a).text()===t.city&&(e._addCityCalloutCta(t.city,$(a).attr("href")),e._addCityButtonCta(t.city,$(a).attr("href")))})}},"undefined"==typeof JanesWalk.user||"undefined"==typeof JanesWalk.user.city?$.getScript("http://freegeoip.net/json/?callback=freeGeoIpCallback"):(e._addCityCalloutCta(JanesWalk.user.city.name,JanesWalk.user.city.url),e._addCityButtonCta(JanesWalk.user.city.name,JanesWalk.user.city.url))},_addMapToggleEvents:function(){var e=this._element.find(".overlap .controls a.showButton"),t=this._element.find(".overlap .controls a.closeButton");e.click(function(){$(".overlap").addClass("fullmap"),$(this).fadeOut(400,function(){t.fadeIn()}),$("html, body").animate({scrollTop:$(this).offset().top-100},800)}),t.click(function(){$(".overlap").removeClass("fullmap"),$(this).fadeOut(400,function(){e.fadeIn()})})}});