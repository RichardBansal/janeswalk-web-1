function MVCArrayBinder(e){this.array_=e}function MapEditor(e){var t=this,n=[{featureType:"poi.business",stylers:[{visibility:"off"}]}],a={zoom:15,scrollwheel:!1,rotateControl:!0,center:new google.maps.LatLng(e.city.lat,e.city.lng),mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE]}};this.map={},this.markers=[],this.poly={},this.point=[],this.userLocation=!1,window.freeGeoIpCallback=function(e){t.userLocation=new google.maps.LatLng(e.latitude,e.longitude)},$.getScript("http://freegeoip.net/json/?callback=freeGeoIpCallback"),this.infowindow=new google.maps.InfoWindow,this.pathMarker=new google.maps.MarkerImage("/img/path.marker.png",null,new google.maps.Point(0,0),new google.maps.Point(8,10)),this.stopMarker={url:"../../../img/marker.png",size:new google.maps.Size(30,46),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(11,44)},this.map=new google.maps.Map(document.querySelector("#map-canvas"),a),this.map.setOptions({styles:n}),this.initPoly()}if(document.addEventListener("DOMContentLoaded",function(){var e=document.body.getAttribute("data-pageViewName")||"PageView";if(e)try{new window[e]($(document.body))}catch(t){console.log("Error instantiating page view "+e+": "+t)}var n=document.getElementById("ccm-toolbar");n&&window.addEventListener("keyup",function(e){if("INPUT"!==e.target.tagName)switch(e.preventDefault(),String(e.key||e.keyCode&&String.fromCharCode(e.keyCode)||e.char).toUpperCase()){case"M":n.style&&(n.style.zIndex=99999==n.style.zIndex?-1:99999)}})}),function(){var e=!1,t=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function a(){!e&&this.init&&this.init.apply(this,arguments)}var i=this.prototype,o=function(e,t){return function(){var n=this._super;this._super=i[e];var a=t.apply(this,arguments);return this._super=n,a}};e=!0;var r=new this;e=!1;for(var s in n)r[s]="function"==typeof n[s]&&"function"==typeof i[s]&&t.test(n[s])?o(s,n[s]):n[s];return a.prototype=r,a.prototype.constructor=a,a.extend=arguments.callee,a}}(),Function.prototype.bind||(Function.prototype.bind=function(e){"use strict";if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,a=function(){},i=function(){return n.apply(this instanceof a&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,i.prototype=new a,i}),function(){"use strict";var e=Object.prototype,t=e.__defineGetter__,n=e.__defineSetter__,a=e.__lookupGetter__,i=e.__lookupSetter__,o=e.hasOwnProperty;t&&n&&a&&i&&(Object.defineProperty||(Object.defineProperty=function(e,r,s){if(arguments.length<3)throw new TypeError("Arguments not optional");if(r+="",o.call(s,"value")&&(!a.call(e,r)&&!i.call(e,r)&&(e[r]=s.value),o.call(s,"get")||o.call(s,"set")))throw new TypeError("Cannot specify an accessor and a value");if(!(s.writable&&s.enumerable&&s.configurable))throw new TypeError("This implementation of Object.defineProperty does not support false for configurable, enumerable, or writable.");return s.get&&t.call(e,r,s.get),s.set&&n.call(e,r,s.set),e}),Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(e,t){if(arguments.length<2)throw new TypeError("Arguments not optional.");t+="";var n={configurable:!0,enumerable:!0,writable:!0},r=a.call(e,t),s=i.call(e,t);return o.call(e,t)?r||s?(delete n.writable,n.get=n.set=void 0,r&&(n.get=r),s&&(n.set=s),n):(n.value=e[t],n):n}),Object.defineProperties||(Object.defineProperties=function(e,t){var n;for(n in t)o.call(t,n)&&Object.defineProperty(e,n,t[n])}))}(),!(document.documentElement.dataset||Object.getOwnPropertyDescriptor(Element.prototype,"dataset")&&Object.getOwnPropertyDescriptor(Element.prototype,"dataset").get)){var propDescriptor={enumerable:!0,get:function(){"use strict";var e,t,n,a,i,o,r=this,s=this.attributes,l=s.length,c=function(e){return e.charAt(1).toUpperCase()},d=function(){return this},p=function(e,t){return"undefined"!=typeof t?this.setAttribute(e,t):this.removeAttribute(e)};try{({}).__defineGetter__("test",function(){}),t={}}catch(h){t=document.createElement("div")}for(e=0;l>e;e++)if(o=s[e],o&&o.name&&/^data-\w[\w\-]*$/.test(o.name)){n=o.value,a=o.name,i=a.substr(5).replace(/-./g,c);try{Object.defineProperty(t,i,{enumerable:this.enumerable,get:d.bind(n||""),set:p.bind(r,a)})}catch(m){t[i]=n}}return t}};try{Object.defineProperty(Element.prototype,"dataset",propDescriptor)}catch(e){propDescriptor.enumerable=!1,Object.defineProperty(Element.prototype,"dataset",propDescriptor)}}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"use strict";if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var t,n=Object(e),a=!1,i=1;i<arguments.length;i++){var o=arguments[i];if(void 0!==o&&null!==o){for(var r=Object.keys(Object(o)),s=0,l=r.length;l>s;s++){var c=r[s];try{var d=Object.getOwnPropertyDescriptor(o,c);void 0!==d&&d.enumerable&&(n[c]=o[c])}catch(p){a||(a=!0,t=p)}}if(a)throw t}}return n}});var FacebookShareDialog=Class.extend({_shareObj:null,init:function(e){this._shareObj=e,this._shareObj.method="feed"},show:function(e,t){FB.ui(this._shareObj,function(n){void 0!==n&&(null===n?e&&e():t&&t())})}});MVCArrayBinder.prototype=new google.maps.MVCObject,MVCArrayBinder.prototype.get=function(e){return isNaN(parseInt(e))?void this.array_.get(e):this.array_.getAt(parseInt(e))},MVCArrayBinder.prototype.set=function(e,t){isNaN(parseInt(e))?this.array_.set(e,t):this.array_.setAt(parseInt(e),t)},MapEditor.prototype.bindDomEvents=function(){var e=this;document.getElementById("route-stops").addEventListener("click",function(){var t=e.markers[this.dataset.stop];google.maps.event.trigger(t,"click")}),document.getElementById("addpoint").addEventListener("click",function(){e.addmarker(),google.maps.event.trigger(e.markers[e.markers.length-1],"click")}),document.getElementById("addmeetingplace").addEventListener("click",function(){e.addMeetingPlace(),google.maps.event.trigger(e.markers[e.markers.length-1],"click")}),document.querySelector(".clear-route").addEventListener("click",function(t){var n=window.confirm("Do you want to remove your walk route? Your Stops will not be deleted.");n&&e.clearRoute(),t.preventDefault()}),document.getElementById("addroute").addEventListener("click",function(){if($(this).hasClass("active")){for($(this).html('<i class="icon-map-route"></i> Edit Route').removeClass("btn-primary active"),$(".map-notifications").html(""),$("#addpoint").prop("disabled",!1),$(".disable-alert").css({zIndex:"-1"}),google.maps.event.clearListeners(e.map,"click"),i=0;i<e.point.length;i++)e.point[i].setVisible(!1),e.point[i].setDraggable(!1);for(i=0;i<e.markers.length;i++)e.addmarkerListener(e.markers[i]),e.markers[i].setDraggable(!0);e.poly.setEditable(!1)}else{for($(this).html('<i class="icon-thumbs-up"></i> Save Route').addClass("btn-primary active"),$(".map-notifications").html('<div class="alert alert-info">Click on the map to draw your route. Right click to undo a route marker.</div>'),$("#addpoint").prop("disabled",!0),$(".disable-alert").css({zIndex:"5"}),google.maps.event.addListener(e.map,"click",function(t,n,a,i){e.addlines(t,n,a,i)}),i=0;i<e.point.length;i++)e.point[i].setVisible(!0),e.point[i].setDraggable(!0);for(i=0;i<e.markers.length;i++)google.maps.event.removeListener(e.markers[i].listener),e.markers[i].setDraggable(!1),e.markers[i].setClickable(!1);e.poly.setEditable(!0)}if(0===e.markers.length)return!1;if(e.point.length<=0){lat=e.map.getCenter().lat(),lng=e.map.getCenter().lng();var t=(new google.maps.LatLng(lat,lng),e.markers[0]),n=new google.maps.InfoWindow({content:"Click here to start your Route"});n.open(e.map,t),google.maps.event.addListenerOnce(e.map,"click",function(){n.close()})}}),google.maps.event.addListener(e.map,"resize",function(){e.centerRoute()})},MapEditor.prototype.createHomeControl=function(e){e.style.padding="5px";var t=document.createElement("div");t.style.backgroundColor="white",t.style.borderStyle="solid",t.style.borderWidth="2px",t.style.cursor="pointer",t.style.textAlign="center",t.title="Click to set the map to Home",e.appendChild(t);var n=document.createElement("div");n.style.fontFamily="Arial,sans-serif",n.style.fontSize="12px",n.style.paddingLeft="4px",n.style.paddingRight="4px",n.innerHTML="<b>Home</b>",t.appendChild(n),google.maps.event.addDomListener(t,"click",function(){navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);_this.map.setCenter(t)},function(){})})},MapEditor.prototype.pathSet=function(){for(var e=this.poly.getPath(),t=e.getLength(),n="",a=0;t>a;a++)n+=e.getAt(a).toUrlValue(6);console.log(n)},MapEditor.prototype.addMarkerListener=function(e){var t=this,n='<div class="stop-form"><input type="text" value="'+e.title+'" class="marker-title" placeholder="Title of this stop"><br><textarea class="marker-description box-sizing" placeholder="Description of this stop">'+e.description+'</textarea><br><textarea class="marker-questions box-sizing" placeholder="A few questions for participants">'+e.questions+'</textarea><br><button class="btn btn-primary" id="save-marker">Save Stop</button> <button class="btn" id="delete-marker">Delete</button></div>';t.map.panBy(0,-20),e.listener=google.maps.event.addListener(e,"click",function(){t.infowindow.setContent(n),t.infowindow.open(t.map,e),t.deleteMarkerButton(e),t.saveMarkerButton(e)})},MapEditor.prototype.updateChart=function(){$("#route-stops tbody").empty();for(var e=0;e<this.markers.length;e++)$("#route-stops tbody").append("<tr><td>"+this.markers[e].title+"</td><td>"+this.markers[e].description+'</td><td><a class="delete-stop" href="#map-canvas" data-stop='+e+">Edit</a></td></tr>")},MapEditor.prototype.addLines=function(e,t,n,a){var i,o,r=this;if(n?(i=new google.maps.LatLng(n,a),o=!1):(i=e.latLng,o=!0),t||(t="#"+l),$("#addroute").hasClass("active")||t){var s=r.poly.getPath();s.push(i);var l=s.getLength(),c=new google.maps.Marker({position:i,title:t,map:r.map,draggable:!0,icon:r.pathMarker,zIndex:100,visible:o});c.bindTo("position",r.poly.binder,(l-1).toString()),r.point.push(c),google.maps.event.addListener(c,"rightclick",function(){for(var e=0;e<r.point.length;e++)r.point[e]===r&&r.point.splice(e,1);c.setMap(null),s.removeAt(l-1)})}},MapEditor.prototype.addMeetingPlace=function(e,t,n,a,i){var o=this;a||(a=o.map.getCenter().lat()),i||(i=o.map.getCenter().lng()),t||(t=""),n||(n="");var r=new google.maps.LatLng(a,i),s=new google.maps.Marker({position:r,animation:google.maps.Animation.DROP,crossOnDrag:!0,draggable:!0,title:t,description:n,style:"meeting",icon:o.stopMarker,map:o.map}),l='<div class="stop-form"><input type="text" value="'+s.title+'" placeholder="Name of your meeting place" class="marker-title"><br><textarea class="marker-description box-sizing" placeholder="Describe where you are meeting">'+s.description+'</textarea><br><button class="btn btn-primary" id="save-marker">Save Meeting Place</button> <button class="btn" id="delete-marker">Delete</button></div>';a?(o.markers.push(s),$("#addmeetingplace").prop("disabled",!0)):(o.infowindow.setContent(l),o.infowindow.open(o.map,s)),google.maps.event.addListener(s,"click",function(){o.infowindow.setContent(l),o.map.panTo(s.getPosition()),o.infowindow.open(o.map,s),o.deleteMarkerButton(s),o.saveMarkerButton(s)})},MapEditor.prototype.addMarker=function(e,t,n,a,i,o){i||(i=this.map.getCenter().lat()),o||(o=this.map.getCenter().lng()),t||(t=""),n||(n=""),a||(a="");var r=new google.maps.LatLng(i,o),s=new google.maps.Marker({position:r,animation:google.maps.Animation.DROP,draggable:!0,title:t,icon:this.stopMarker,style:"stop",description:n,questions:a,map:this.map}),l='<div class="stop-form"><input type="text" value="'+s.title+'" placeholder="Title of this stop" class="marker-title"><br><textarea class="marker-description box-sizing" placeholder="Description of this stop">'+s.description+'</textarea><br><button class="btn btn-primary" id="save-marker">Save Stop</button> <button class="btn" id="delete-marker">Delete</button></div>';i?this.markers.push(s):(infowindow.setContent(l),infowindow.open(this.map,s)),this.addmarkerListener(s),this.updateChart()},MapEditor.prototype.saveMarkerButton=function(e){var t=this;google.maps.event.addListenerOnce(t.infowindow,"domready",function(){google.maps.event.addDomListener(document.getElementById("save-marker"),"click",function(){for(var n=0;n<t.markers.length;n++)t.markers[n]===e&&t.markers.splice(n,1);e.title=$(".marker-title").val(),e.description=$(".marker-description").val(),t.markers.push(e),$("#addmeetingplace").prop("disabled",!0),t.updateChart(),setTimeout(function(){t.infowindow.close(t.map,e)},500)})})},MapEditor.prototype.initPoly=function(){var e={strokeColor:"#F16725",strokeOpacity:.8,strokeWeight:3,editable:!1,map:this.map};this.poly=new google.maps.Polyline(e),this.poly.binder=new MVCArrayBinder(this.poly.getPath())},MapEditor.prototype.deleteMarkerButton=function(e){var t=this;google.maps.event.addListenerOnce(t.infowindow,"domready",function(){google.maps.event.addDomListener(document.getElementById("delete-marker"),"click",function(){e.setMap(null);for(var n=0;n<t.markers.length;n++)t.markers[n]===e&&t.markers.splice(n,1);$("#addmeetingplace").prop("disabled",!1),t.updateChart()})})},MapEditor.prototype.removeLines=function(){this.poly.binder.getAt(marker)},MapEditor.prototype.clearRoute=function(){this.poly.setMap(null);for(var e=0;e<this.point.length;e++)this.point[e].setMap(null);this.point=[],this.initPoly()},MapEditor.prototype.centerRoute=function(){var e=this;if(e.point.length){var t=new google.maps.LatLngBounds;for(i=0;i<e.point.length;i++)t.extend(e.point[i].position);e.map.setCenter(t.getCenter())}else e.userLocation!==!1&&e.map.setCenter(e.userLocation)};var View=Class.extend({_element:null,init:function(e){this._element=e},getElement:function(){return this._element}}),ModalView=View.extend({init:function(e){this._super(e),this._addCloseEvents()},_addCloseEvents:function(){var e=this;this._element.find(".closeModalSource").click(function(t){t.preventDefault(),e.close()})}}),PageView=View.extend({init:function(e){this._super(e),this._addNavEvents(),this._addOverlayCloseEvent()},_addOverlayCloseEvent:function(){var e=this;this._element.find(".o-background").click(function(){e._element.find(".overlay").hide()}),this._element.find("a.closeModalCta").click(function(t){t.preventDefault(),e._element.find(".overlay").hide()})},_addNavEvents:function(){this._element.find("a.search-open").click(function(){$("html, body").animate({scrollTop:0},300),$("body > header").addClass("dropped")}),this._element.find("a.search-close").click(function(){$("body > header").removeClass("dropped")})},_makeGaCall:function(e){_gaq.push(e)},trackCustomVar:function(e,t,n,a){var i=["_setCustomVar",e,t,n,a];this._makeGaCall(i)},trackEvent:function(e,t,n,a,i){var o=["_trackEvent"];void 0!==e&&o.push(e),void 0!==t&&o.push(t),void 0!==n&&o.push(n),void 0!==a&&o.push(a),this._makeGaCall(o,i)},trackView:function(e){var t=["_trackPageview",e];this._makeGaCall(t)}}),CityPageView=PageView.extend({_accessibility:null,_cards:null,_data:null,_date:null,_initiative:null,_theme:null,_ward:null,init:function(e){this._super(e),this._cards=this._element[0].querySelectorAll(".walk"),this._previewCards(),this._data=JanesWalk.walks,this._resetSelectElements(),this._addCreateWalkEvent(),this._addFilterEvents(),this._setThemeCounts(),this._captureHash(),this._addLinkListeners(),$(".walks-list .tag").tooltip()},_getFacebookDialogDonateObj:function(){return{link:"http://janeswalk.org",name:"Jane's Walk"}},_previewCards:function(){for(var e=Array.prototype.slice.call(this._cards).sort(function(){return.5-Math.random()}),t=document.querySelector(".ccm-block-page-list-walk-filters .walk-preview"),n=0,a=Math.min(e.length,9);a>n;n++){var i=e[n].cloneNode(!0);t.appendChild(i)}},_addLinkListeners:function(){var e=document.querySelector("a.see-all");e&&e.addEventListener("click",function(){document.querySelector(".ccm-block-page-list-walk-filters").classList.add("filtering"),e.parentNode.removeChild(e)})},_setupText2DonateInterstitials:function(){var e,t,n,a,i=!1,o=this,r=null!==location.pathname.match(/\/canada\/[^/]+/);this._element.find("a.closeCatfishCta").click(function(e){e.preventDefault(),o._element.find(".catfish").hide(),jQuery.cookie("hasSeenDonateCatfish","1",{path:"/",domain:location.host})}),i&&r===!0&&(e=null!==jQuery.cookie("hasSeenDonateInterstitial")&&"undefined"!=typeof jQuery.cookie("hasSeenDonateInterstitial"),e===!1?(t=function(){jQuery.cookie("hasSeenDonateInterstitial","1",{path:"/",domain:location.host}),o._element.find(".catfish.c-donate").removeClass("hidden")},this._element.find(".overlay.o-donate").show(),this._element.find(".overlay.o-donate .o-background").click(t),this._element.find("a.closeModalCta").click(t),this._element.find("div.btnWrapper a").click(function(e){jQuery.cookie("hasSeenDonateInterstitial","1",{path:"/",domain:location.host}),jQuery.cookie("hasSeenDonateCatfish","1",{path:"/",domain:location.host}),e.preventDefault(),o._element.find(".o-donate").hide(),o._element.find(".o-shout").show(),o._element.find(".o-shout .icon-twitter").click(function(e){e.preventDefault(),n=encodeURIComponent("http://janeswalk.org/"),text=encodeURIComponent($(this).closest(".option").find(".copy").text().trim()),a="https://twitter.com/intent/tweet?url="+n+"&via=janeswalk&text="+text,window.open(a,"Twitter Share","width=640, height=320")}),o._element.find(".o-shout .icon-facebook").click(function(e){e.preventDefault();var t=o._getFacebookDialogDonateObj();t.description=$(this).closest(".option").find(".copy").text().trim(),new FacebookShareDialog(t).show()})})):(hasSeenDonateCatfish=null!==jQuery.cookie("hasSeenDonateCatfish")&&"undefined"!=typeof jQuery.cookie("hasSeenDonateCatfish"),hasSeenDonateCatfish===!1&&this._element.find(".catfish").removeClass("hidden")))},_setThemeCounts:function(){var e,t=this,n=Array.prototype.forEach,a=this._element[0],i=function(n){var a=n.getAttribute("value"),i=this.compare_fn||function(e,t){return e[t]};if("*"!==a){e=0;for(var o in t._data)i(t._data[o][this.filter],a)&&++e;n.textContent+=" ("+e+")",0===e&&n.parentElement.removeChild(n)}};n.call(a.querySelectorAll('div.filters select[name="theme"] option'),i,{filter:"themes"}),n.call(a.querySelectorAll('div.filters select[name="accessibility"] option'),i,{filter:"accessibilities"}),n.call(a.querySelectorAll('div.filters select[name="ward"] option'),i,{filter:"wards"}),n.call(a.querySelectorAll('div.filters select[name="initiative"] option'),i,{filter:"initiatives"}),n.call(a.querySelectorAll('div.filters select[name="date"] option'),i,{filter:"datetimes",compare_fn:function(e,t){for(var n=0;n<e.length;n++)return-1!==e[n].date.indexOf(t)}})},_resetSelectElements:function(){var e=this;this._element.find("div.filters select").each(function(e,t){$(t).val("*")}),this._element.find(".initiatives").addClass("hidden"),this._element.find(".initiative").addClass("hidden"),this._element.find("#initiative").change(function(){"#"!==$(this).val()&&(e._element.find(".initiatives").removeClass("hidden"),e._element.find('[data-jw-initiative="'+$(this).val()+'"]').removeClass("hidden"))})},_addCreateWalkEvent:function(){var e=this,t=this._element.find(".create-walk");t.click(function(t){t.preventDefault(),0===e._element.find('a[href="/index.php/login/logout/"]').length?e._element.find(".overlay.o-connect").show():location.href=$(this).attr("href")})},_captureHash:function(){var e=this;""!==location.hash&&(pieces=location.hash.replace("#","").split("&"),key="",$(pieces).each(function(t,n){key="_"+n.split("=")[0],e[key]=n.split("=")[1]}),this._filterCards(),this._element.find('select[name="ward"]').val(this._ward),this._element.find('select[name="theme"]').val(this._theme),this._element.find('select[name="accessibility"]').val(this._accessibility),this._element.find('select[name="initiative"]').val(this._initiative),this._element.find('select[name="date"]').val(this._date))},_setHash:function(){location.hash="ward="+this._ward+"&theme="+this._theme+"&accessibility="+this._accessibility+"&initiative="+this._initiative+"&date="+this._date},_filterCards:function(){var e,t,n=this,a=0,i=function(e,t){return"*"===e||t&&t[e]};for(e=0,t=this._cards.length;t>e;e++)this._cards[e].classList.add("hidden");this._data.forEach(function(t,o){i(n._ward,t.wards)&&i(n._theme,t.themes)&&i(n._accessibility,t.accessibilities)&&i(n._initiative,t.initiatives)&&function(t,n){if("*"===n)return!0;for(e=0;e<t.length;e++)return-1!==t[e].date.indexOf(n)}(t.datetimes,n._date)&&(++a,n._cards[o].classList.remove("hidden"))}),this._element.find(".empty").addClass("hidden"),0===a&&this._element.find(".empty").removeClass("hidden")},_addFilterEvents:function(){var e=this;this._element.find("div.filters select").change(function(t){t.preventDefault(),e._ward="*",e._element.find('select[name="ward"]').length>0&&(e._ward=e._element.find('select[name="ward"]').val()),e._theme="*",e._element.find('select[name="theme"]').length>0&&(e._theme=e._element.find('select[name="theme"]').val()),e._accessibility="*",e._element.find('select[name="accessibility"]').length>0&&(e._accessibility=e._element.find('select[name="accessibility"]').val()),e._initiative="*",e._element.find('select[name="initiative"]').length>0&&(e._initiative=e._element.find('select[name="initiative"]').val()),e._date="*",e._element.find('select[name="date"]').length>0&&(e._date=e._element.find('select[name="date"]').val()),e._setHash(),e._filterCards()})}}),HomePageView=PageView.extend({init:function(e){this._super(e),this._addMapToggleEvents(),this._addCityLookup(),this._addBgImage(),this._addCityDropdownEvent(),this._addCreateWalkEvent()},_addCreateWalkEvent:function(){var e=this,t=this._element.find('.calltoaction li a[href="/walk/form/"]');t.click(function(t){t.preventDefault(),e._element.find('a[href="/index.php/login/logout/"]').length?location.href=$(this).attr("href"):e._element.find(".overlay").show()})},_addCityDropdownEvent:function(){var e=this._element.find("select.pageListSelect");e.change(function(){location.href=e.val()})},_addBgImage:function(){var e=this._element.attr("data-backgroundImageUrl"),t=this._element.find(".backgroundImageBanner"),n=document.createElement("img");n.onload=function(){t.css({backgroundImage:"url("+e+")"}),t.removeClass("faded")},n.src=e},_addCityCalloutCta:function(e,t){var n=this._element.find(".ccm-page-list-typeahead").first(),a=$("<h3 />"),i=$("<a />");i.attr({href:t}),i.text(e),a.append("See walks in ").append(i).append(", or:"),n.prepend(a)},_addCityButtonCta:function(e,t){var n=this._element.find(".calltoaction ul").first(),a=$("<li />"),i=$("<a />");a.attr({"class":"cityButtonCta"}),i.attr({"class":"btn btn-primary",href:t}),a.append(i),i.text("View walks in "+e),n.prepend(a)},_addCityLookup:function(){var e=this;window.freeGeoIpCallback=function(t){if("undefined"!=typeof t){var n=e._element.find("div.ccm-page-list-typeahead ul li a");n.each(function(n,a){$(a).text()===t.city&&(e._addCityCalloutCta(t.city,$(a).attr("href")),e._addCityButtonCta(t.city,$(a).attr("href")))})}},void 0===JanesWalk.user||void 0===JanesWalk.user.city?$.getScript("http://freegeoip.net/json/?callback=freeGeoIpCallback"):(e._addCityCalloutCta(JanesWalk.user.city.name,JanesWalk.user.city.url),e._addCityButtonCta(JanesWalk.user.city.name,JanesWalk.user.city.url))},_addMapToggleEvents:function(){var e=this._element.find(".overlap .controls a.showButton"),t=this._element.find(".overlap .controls a.closeButton");e.click(function(){$(".overlap").addClass("fullmap"),$(this).fadeOut(400,function(){t.fadeIn()}),$("html, body").animate({scrollTop:$(this).offset().top-100},800)}),t.click(function(){$(".overlap").removeClass("fullmap"),$(this).fadeOut(400,function(){e.fadeIn()})})}}),ProfilePageView=PageView.extend({_slideIndexes:{blogPost:0,city:0,walk:0},_currentTab:null,init:function(e){try{this._super(e),this._showProperStep(),this._addTabClickEvents(),this._setupDisplayPictureFlashWidget(),this._addPictureDeleteEvent(),this._addPromoteWalkClickEvent(),this._addPromoteCityClickEvent(),this._addPromoteBlogPostClickEvent(),this._setupCityPromoteModalEvents(),this._setupWalkPromoteModalEvents(),this._setupBlogPostPromoteModalEvents(),this._setupPromoteSlideshows(),this._setupTransferWalkEvents()}catch(t){console.log("Error initializing profile: "+t)}},_addPictureDeleteEvent:function(){this._element.find('a[href="/index.php/profile/delete/"]').click(function(e){e.preventDefault(),$.ajax({type:"DELETE",url:$(this).attr("href"),success:function(){location.href="/index.php/profile/#tab=picture&success=1"}})})},_addPromoteBlogPostClickEvent:function(){var e=this,t=this._element.find(".column.blogPosts .subactions .promote");t.click(function(t){t.preventDefault();var n=e._getBlogPostObjById($(this).data("blogpostid"));e._element.find(".blogPostPromoteOverlay .copy").each(function(e,t){var a=$(t);a.data("blogpostpath",n.path),a.find(".objTitle").text(n.title)}),e._element.find(".blogPostPromoteOverlay").show()})},_addPromoteCityClickEvent:function(){var e=this,t=this._element.find("#cityBlock .promoteBtn");t.click(function(t){t.preventDefault(),e._element.find(".cityPromoteOverlay").show()})},_getBlogPostObjById:function(e){var t=this._element.find('[data-blogpostid="'+e+'"]');return{title:t.first().data("blogposttitle"),path:t.first().data("blogpostpath")}},_getWalkObjById:function(e){var t=this._element.find('[data-walkid="'+e+'"]');return{title:t.first().data("walktitle"),path:t.first().data("walkpath")}},_addPromoteWalkClickEvent:function(){var e=this,t=this._element.find(".column.city .subactions .promote,.column.walks .subactions .promote");t.click(function(t){t.preventDefault();var n=e._getWalkObjById($(this).data("walkid"));e._element.find(".walkPromoteOverlay .copy").each(function(e,t){var a=$(t);a.data("walkpath",n.path),a.find(".objTitle").text(n.title)}),e._element.find(".walkPromoteOverlay").show()})},_addTabClickEvents:function(){var e=this;this._element.find("ul.nav-tabs li a").click(function(t){t.preventDefault(),e._currentTab=$(this).attr("data-tab"),e._showCurrentTab()}),this._element.find(".tabLink").click(function(t){t.preventDefault(),e._currentTab=$(this).attr("data-tab"),e._showCurrentTab()})},_setupBlogPostPromoteModalEvents:function(){var e=this;this._element.find(".blogPostPromoteOverlay").find(".icon-twitter").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showTwitterShareWindow("http://janeswalk.org"+n.data("blogpostpath"),n.text().trim())}),this._element.find(".blogPostPromoteOverlay").find(".icon-facebook").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showFacebookShareWindow("http://janeswalk.org"+n.data("blogpostpath"),"Jane's Walk",n.text().trim())}),this._element.find(".blogPostPromoteOverlay").find(".icon-envelope").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showEmailShareWindow("Jane's Walk in "+e._element.find("#profileWrapper").data("city"),n.text().trim())})},_setupCityPromoteModalEvents:function(){var e=this._element.find(".cityPromoteOverlay").data("citypath"),t=this._element.find(".cityPromoteOverlay").data("cityname"),n=this;this._element.find(".cityPromoteOverlay").find(".icon-twitter").click(function(t){t.preventDefault(),n._showTwitterShareWindow("http://janeswalk.org"+e,$(this).closest(".option").find(".copy").text().trim())}),this._element.find(".cityPromoteOverlay").find(".icon-facebook").click(function(t){t.preventDefault(),n._showFacebookShareWindow("http://janeswalk.org"+e,"Jane's Walk",$(this).closest(".option").find(".copy").text().trim())}),this._element.find(".cityPromoteOverlay").find(".icon-envelope").click(function(e){e.preventDefault(),n._showEmailShareWindow("Jane's Walk in "+t,$(this).closest(".option").find(".copy").text().trim())})},_setupTransferWalkEvents:function(){var e=this;this._element.find("#walk-transfer .users a").click(function(e){e.preventDefault(),$.get(this.getAttribute("href"),function(e){e.error?alert(e.error):window.location=window.location})}),this._element.find("a.transfer").removeClass("hidden").click(function(t){t.preventDefault();for(var n=e._element.find("#walk-transfer"),a=this.getAttribute("href"),i=n.find(".users a"),o=0,r=i.length;r>o;o++)i[o].setAttribute("href",a+"transfer/"+i[o].getAttribute("data-uid"));n.modal()})},_setupDisplayPictureFlashWidget:function(){window.ThumbnailBuilder_onSaveCompleted=function(){location.href="/index.php/profile/#tab=picture&success=1"};var e={bgcolor:"#ffffff",wmode:"transparent",quality:"high"},t={width:this._element.find("#flashContainer").attr("data-width"),height:this._element.find("#flashContainer").attr("data-height"),image:this._element.find("#flashContainer").attr("data-imagepath"),save:this._element.find("#flashContainer").attr("data-savepath")};"undefined"!=typeof swfobject&&swfobject.embedSWF(this._element.find("#flashContainer").attr("data-flashpath"),"flashContainer","500","400","10,0,0,0","includes/expressInstall.swf",t,e)},_showSlide:function(e){var t=this._slideIndexes[e],n=this._element.find('[data-slideshow="'+e+'"]'),a=n.find(".options .option");a.addClass("hidden"),$(a[t]).removeClass("hidden")},_setupPromoteSlideshows:function(){var e=this;this._element.find(".promoteOverlay .nav > a.left").click(function(t){t.preventDefault();{var n=$(this),a=n.data("slideshow"),i=n.closest(".promoteOverlay"),o=i.find(".options .option").length;i.find(".options .option")}0===e._slideIndexes[a]?e._slideIndexes[a]=o-1:--e._slideIndexes[a],e._showSlide(a)}),this._element.find(".promoteOverlay .nav > a.right").click(function(t){t.preventDefault();{var n=$(this),a=n.data("slideshow"),i=n.closest(".promoteOverlay"),o=i.find(".options .option").length;i.find(".options .option")}e._slideIndexes[a]===o-1?e._slideIndexes[a]=0:++e._slideIndexes[a],e._showSlide(a)})},_setupWalkPromoteModalEvents:function(){var e=this;this._element.find(".walkPromoteOverlay").find(".icon-twitter").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showTwitterShareWindow("http://janeswalk.org"+n.data("walkpath"),n.text().trim())}),this._element.find(".walkPromoteOverlay").find(".icon-facebook").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showFacebookShareWindow("http://janeswalk.org"+n.data("walkpath"),"Jane's Walk",n.text().trim())}),this._element.find(".walkPromoteOverlay").find(".icon-envelope").click(function(t){t.preventDefault();var n=$(this).closest(".option").find(".copy");e._showEmailShareWindow("Jane's Walk in "+e._element.find("#profileWrapper").data("city"),n.text().trim())})},_showCurrentTab:function(){this._element.find("ul.nav-tabs li.active").removeClass("active"),this._element.find('ul.nav-tabs li a[data-tab="'+this._currentTab+'"]').parent().addClass("active"),this._element.find("div.content div.block").addClass("hidden"),this._element.find('div.content div.block[data-tab="'+this._currentTab+'"]').removeClass("hidden"),location.hash="tab="+this._currentTab},_showEmailShareWindow:function(e,t){e=encodeURIComponent(e),t=encodeURIComponent(t);var n="mailto:?subject="+e+"&body="+t;window.open(n)},_showFacebookShareWindow:function(e,t,n){new FacebookShareDialog({link:e,name:t,description:n}).show()},_showProperStep:function(){if(""!==location.hash){var e,t=location.hash.split("&"),n={};$(t).each(function(t,a){e=a.split("="),n[e[0].replace("#","")]=e[1]}),this._currentTab=n.tab,this._showCurrentTab(),"undefined"!=typeof n.success&&1===parseInt(n.success)&&this._element.find('div.content div.block[data-tab="'+this._currentTab+'"]').addClass("success")}},_showTwitterShareWindow:function(e,t){e=encodeURIComponent(e),t=encodeURIComponent(t),t.length>130&&(t=t.substring(0,130)+"..."),e="https://twitter.com/intent/tweet?url="+e+"&via=janeswalk&text="+t,window.open(e,"Twitter Share","width=640, height=320")
}}),WalkPageView=PageView.extend({init:function(e){this._super(e),this._addFacebookDialogEvents(),this._initializeMap()},_addFacebookDialogEvents:function(){var e=this;this._element.find(".facebookShareLink").click(function(t){t.preventDefault(),e.trackEvent("Walk","share.attempted","facebook");var n=e._getFacebookDialogObj();new FacebookShareDialog(n).show(e._facebookShareFailed,e._facebookShareSuccessful)})},_facebookShareFailed:function(){this.trackEvent("Walk","share.failed","facebook")},_facebookShareSuccessful:function(){this.trackEvent("Walk","share.successful","facebook")},_getFacebookDialogObj:function(){return{link:JanesWalk.page.url,picture:JanesWalk.page.pictureUrl,name:JanesWalk.page.title,description:JanesWalk.page.description,actions:{name:"View Jane's Walks in "+JanesWalk.page.city.name,link:JanesWalk.page.city.url}}},_styledMap:new google.maps.StyledMapType([{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"on"},{saturation:-100}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{saturation:-100}]},{featureType:"landscape.natural",stylers:[{saturation:-100},{lightness:36}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{visibility:"on"},{saturation:37}]},{featureType:"landscape.man_made",stylers:[{saturation:-100}]}],{name:"Styled Map"}),_initializeMap:function(){var e,t,n,a,i=[],o="undefined"==typeof zoomLevelset?16:zoomLevelset,r={zoom:o,scrollwheel:!1,zoomControl:!0,disableDefaultUI:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}},s=new google.maps.Map(document.getElementById("map-canvas"),r),l=[],c="../../../../img/marker.png",d=new google.maps.InfoWindow({maxWidth:300}),p=new InfoBox({content:document.getElementById("infobox"),maxWidth:150,pixelOffset:new google.maps.Size(-3,-25),alignBottom:!0,boxStyle:{background:"#fff",width:"280px",padding:"10px",border:"1px solid #eee"},closeBoxMargin:"-22px -22px 2px -8px",closeBoxURL:"../../../../img/map-close.png",infoBoxClearance:new google.maps.Size(20,20)}),h=function(e,t,n){return function(){for(var a=0;a<i.length;a++)i[a].setIcon(f);s.panTo(e.getPosition()),this.setIcon(m),d.setContent(React.renderToStaticMarkup(React.createElement("div",null,React.createElement("h4",null,JanesWalk.page.gmap.markers[t].title),React.createElement("p",null,JanesWalk.page.gmap.markers[t].description),n))),p.open(s,e),$(".walk-stop").removeClass("active"),$(".walk-stops-meta #"+t).addClass("active");$(".active");$(".walk-stops-meta").mCustomScrollbar("scrollTo",".active")}},m=new google.maps.MarkerImage("../../../../img/marker-active.png"),f=new google.maps.MarkerImage("../../../../img/marker.png");for(t in JanesWalk.page.gmap.route)l.push(new google.maps.LatLng(JanesWalk.page.gmap.route[t].lat,JanesWalk.page.gmap.route[t].lng));e=new google.maps.Polyline({path:l,strokeColor:"#F16725",strokeOpacity:.8,strokeWeight:4}),e.setMap(s),s.mapTypes.set("map_style",this._styledMap),s.setMapTypeId("map_style");for(var u in JanesWalk.page.gmap.markers)marker=new google.maps.Marker({position:new google.maps.LatLng(JanesWalk.page.gmap.markers[u].lat,JanesWalk.page.gmap.markers[u].lng),map:s,icon:c,id:u}),i.push(marker),a="",$("body").hasClass("create-page")&&(a=React.createElement("button",{className:"btn pull-right",id:"delete-marker"},React.createElement("i",{className:"fa fa-trash"}))),google.maps.event.addListener(marker,"click",h(marker,u,a));$(".walk-stops").show();var g=new google.maps.LatLngBounds;for(n in i)g.extend(i[n].getPosition());for(n in e.getPath().getArray())g.extend(e.getPath().getAt(n));i.length>0&&s.fitBounds(g),google.maps.event.addListenerOnce(s,"zoom_changed",function(){var e=s.getZoom();s.setZoom(Math.min(16,e))}),google.maps.event.addDomListener(document.getElementById("map-canvas"),"touchstart",function(){s.setOptions({panControl:!1,draggable:!1})}),google.maps.event.addListener(marker,"dragend",function(){var e=marker.getPosition();s.panTo(e),document.getElementById("txt_latlng").value=e.lat()+", "+e.lng()}),google.maps.event.addListenerOnce(d,"domready",function(){google.maps.event.addDomListener(document.getElementById("save-marker"),"click",function(){d.close(s,marker)})}),$(".walk-stop").on("click",function(){marker=i[this.id],$(".walk-stop").removeClass("active"),$(this).addClass("active"),google.maps.event.trigger(marker,"click")})}});